<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://blog.maikel.dev/feed.xml" rel="self" type="application/atom+xml" /><link href="https://blog.maikel.dev/" rel="alternate" type="text/html" /><updated>2026-01-08T22:31:38+01:00</updated><id>https://blog.maikel.dev/feed.xml</id><title type="html">Maikelology</title><subtitle>Ramblings of @maikel@vmst.io</subtitle><author><name>Maikel Frias Mosquea</name></author><entry><title type="html">I Tried Cursor and I‚Äôm Not Worried</title><link href="https://blog.maikel.dev/2026/01/02/i-tried-cursor-and-im-not-worried.html" rel="alternate" type="text/html" title="I Tried Cursor and I‚Äôm Not Worried" /><published>2026-01-02T00:00:00+01:00</published><updated>2026-01-02T00:00:00+01:00</updated><id>https://blog.maikel.dev/2026/01/02/i-tried-cursor-and-im-not-worried</id><content type="html" xml:base="https://blog.maikel.dev/2026/01/02/i-tried-cursor-and-im-not-worried.html"><![CDATA[<p>The image I‚Äôve chosen from Unsplash for this article is no accident at all, keep reading and you‚Äôll figure out why.</p>

<p>I recently survived showing someone <code class="language-plaintext highlighter-rouge">sparkr_private</code>, a repo containing a prototype version of <a href="https://codeberg.org/maikelthedev/sparkr">Sparkr</a> I built in React Native within a week. The goal wasn‚Äôt to build production code. It was to rapidly test <strong>feasibility</strong> of ideas, disposing of concepts quickly just to see what could actually be possible based on ideas in my head.</p>

<p>The result? Shameful code. Heavily written with the help of LLMs (specifically Cursor), it‚Äôs 100% slop built on top of slop, designed to answer one question after another:</p>

<ol>
  <li>Is this possible? Yes.</li>
  <li>Ok, is this possible? Yes, ok, next.</li>
  <li>Is this possible? Yes, ok, next.</li>
  <li>Is this possible? No? Ohhh, what if I do it this way? Yes, ok next.</li>
</ol>

<p>Rinse and repeat until I had all my questions answered.</p>

<p>The code <strong>individually</strong> worked, but integrated would probably make any mobile phone explode. There were no test suites, just monkey trialing after each idea. No integration tests. Once a feature was proved feasible I run the app on my phone, tested it manually, then I read the code to understand how, then I moved onto checking how the next one could be done. I guarantee you most new ideas broke the previous ones. I‚Äôm still debating with myself whether to make that code public.</p>

<p>But here‚Äôs the thing: it worked for its purpose. I learned that NIP-17 e2ee direct chat was possible (even if implemented in extremely wasteful and verbose ways) to add to a chatting app easily. I proved uploading facepics using free-to-use <a href="https://github.com/nostr-protocol/nips/blob/master/B7.md">Blossom relays </a>could work. I validated a grid <strong>directory</strong> system based on relays passed via app signature, posted in public relays.</p>

<p>From there onwards, I had all I needed to know it was feasible.</p>

<h2 id="the-only-valid-use-case">The Only Valid Use Case</h2>

<p>After this experiment, I‚Äôve found the only valid use case for LLMs in software development: testing feasibility of random ideas on disposable code to motivate yourself enough to code them yourself.</p>

<p><strong>Once you‚Äôve seen it, you want to make it real</strong>. You‚Äôre no longer working with an idea in your head. You answered each and every question you could have about it, to completion, and saw its full potential. It‚Äôs a bit like experiencing the joy of seeing your own children grow up and get married, knowing you made it happen, you raised a good kid, before actually deciding to have children. There‚Äôs no what if, there‚Äôs only a clear path. There‚Äôs no scrum or agile ever changing requirements, you‚Äôve gone from specification to final broken thing that kind of works. There‚Äôs no ifs, there‚Äôs no uncertainty. You‚Äôve seen it, had it in your hands, made of your ideas. Ignore the code, you just wanted to know if it could exist. You know now it can exist. It is <strong>a certainty</strong>.</p>

<p>Or, put another way: helping you gather answers to all the burning questions you might have on a software project before you write the first line of actual decent code.</p>

<p>This is genuinely useful. When you‚Äôre exploring a new domain, trying to understand if something is technically possible, or rapidly prototyping to validate concepts, discard what you figure doesn‚Äôt work and move onto quicker into alternative options.</p>

<p>But that‚Äôs where it ends.</p>

<h2 id="where-llms-fail-catastrophically">Where LLMs Fail Catastrophically</h2>

<p>If you‚Äôre thinking about using LLMs for actual software development, here‚Äôs where they IMHO fall apart:</p>

<h3 id="1-elegance">1. Elegance</h3>

<p>LLMs don‚Äôt understand elegance. They don‚Äôt grasp clean architecture, beautiful abstractions, or thoughtful design patterns. They‚Äôll give you code that works, but it‚Äôs the software equivalent of a functional but ugly building. It stands, but you wouldn‚Äôt want to live in it. Stupid ridiculous thing never had to pass an exam on algorithms, data structure or Big O notation, <a href="https://www.open.ac.uk/courses/modules/m269/"><strong>you did.</strong></a></p>

<p>They‚Äôll write stuff like this üëá</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">doStuff</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">a</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">b</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">doing stuff</span><span class="dl">"</span><span class="p">);</span>
            <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">c</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nf">setTimeout</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
              <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>There are some basic principles of software development that they simply ignore:</p>

<ul>
  <li>KISS, they write incredibly long lines of code with no specialisation or compartimentalisation in smaller functions, it‚Äôs untestable due to how long and how many variables it depends on .</li>
  <li>DRY, they write the same lines across entire codebases again and again.</li>
  <li>‚Ä¶.you can find the whole damn list here in Wikipedia. No one who‚Äôs studied software engineering would be unaware of the existence of those and many other rules.</li>
</ul>

<p>Anyone who‚Äôs coded for a couple of years can easily identify code written by a LLM compared to code written by a human.</p>

<h3 id="2-refactoring-and-global-view">2. Refactoring and Global View</h3>

<p>Ask an LLM to refactor code, and you‚Äôll get a mess. They don‚Äôt understand the subtle relationships between components, the reasons behind certain design decisions, or how to improve code while maintaining its integrity. They‚Äôll <strong>change things that shouldn‚Äôt be changed</strong> and <strong>leave problems that should be fixed.</strong></p>

<p>They‚Äôre terrible at handling project specific requirements, domain knowledge, or nuanced business logic. They‚Äôll give you generic solutions that don‚Äôt quite fit your actual needs. The devil is in the details, and LLMs are detail blind because they can‚Äôt see things <strong>globally</strong>. Why? Context. Remember, they aren‚Äôt human.</p>

<p>I‚Äôll talk more about this context thing later, but this is what makes them behave like elderly people with üëá and the main reason I‚Äôll never fear them.
<img src="https://images.unsplash.com/photo-1619963030941-69eb5b7ef496?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wxMTc3M3wwfDF8c2VhcmNofDEzfHxhbHpoZWltZXJ8ZW58MHx8fHwxNzY3MzkxNTMzfDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=2000" alt="white and yellow letter t" /></p>
<h3 id="3-testing">3. Testing</h3>

<p>Tests written by LLMs are <strong>awful</strong>. They test the wrong things, is not that they miss edge cases, but that they implementation details rather than behavior. Good testing requires understanding the system, its requirements, and potential failure modes, all things LLMs struggle with because of <strong>a lack of a global view.</strong> Context, my friend, that‚Äôs why you‚Äôll always have a job.</p>

<h3 id="4-anything-involving-refinement">4. Anything Involving Refinement</h3>

<p>LLMs are one-shot generators. They don‚Äôt iterate well. They don‚Äôt learn from feedback in a meaningful way. Real software development is iterative refinement, taking something that works and making it better, cleaner, more maintainable. LLMs can‚Äôt do this. You can tell them to rewrite the same function ten times and I gurantee you by the fourth time you‚Äôll get again the first version. Again, why? Repeat after me: <strong>context.</strong></p>

<h3 id="5-language-support-beyond-python-and-javascript">5. Language Support Beyond Python and JavaScript</h3>

<p>LLMs fail catastrophically at any language that‚Äôs not Python or JavaScript. In Elixir, for example, they even make up non-existent functions of core modules. They‚Äôll confidently suggest core-language functions that don‚Äôt exist, use incorrect syntax, and provide solutions that simply won‚Äôt compile or run. Let alone they are <strong>dated by design</strong>. Why do you think their best language for any of them to prototype with is JavaScript?</p>

<h2 id="the-junior-dev-fallacy">The ‚ÄúJunior Dev‚Äù Fallacy</h2>

<p>People who defend LLMs as if they were the 2nd cumming (typo intended) of Jesuschrist often say: ‚ÄúIt‚Äôs like sitting with a junior developer.‚Äù
<strong>No, it‚Äôs not.&lt;/blockquote&gt;
A junior developer **thinks</strong>. They ask questions. They learn. They make mistakes and understand why they made them. They <strong>grow their knowledge</strong>, they refine, they get better. They bring human judgment, <strong>creativity</strong>, and reasoning to the table.</p>

<p>An LLM vomits. It generates text based on patterns it‚Äôs seen, without understanding, without reasoning, without the ability to truly learn from <strong>context</strong> in the way a human does.</p>

<p>But here‚Äôs the critical difference that makes human coders irreplaceable:
<strong>context</strong>.&lt;/blockquote&gt;<img src="https://images.unsplash.com/photo-1762894764362-d264b9ffc92a?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wxMTc3M3wwfDF8c2VhcmNofDE0M3x8Y29udGV4dHxlbnwwfHx8fDE3NjczOTIzOTl8MA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=2000" alt="People waiting at a mural-adorned bus stop" /></p>
<h1 id="what-do-you-even-mean-with-context-maikel">What do you even mean with ‚Äúcontext‚Äù Maikel?</h1>

<p>A <strong>human</strong> developer can maintain a massively <strong>humongous</strong> context. They can hold in their head the entire architecture of a system, understand how components interact, remember why certain decisions were made months <strong>if not years</strong> ago, see the big picture and the small details simultaneously. They can trace through code mentally, understand the flow of data, see relationships that aren‚Äôt explicitly documented, and make connections across the entire codebase. They have <strong>a global vision.</strong></p>

<p>I have ADHD yet unlike most, when I‚Äôm unmedicated, my working memory is so large I can hold in my head the entire architecture of an idea for weeks if not months. I can think through complex systems, see how everything connects, and maintain that mental model continuously while I try pseudocode in my head.<strong>An LLM can‚Äôt do more than a few prompts without forgetting the entire subject.</strong> Even the most advanced models with massive context windows can‚Äôt maintain that kind of persistent, deep understanding. They reset. They forget. They can‚Äôt hold onto the architecture the way a human mind can.</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">**Context: T**here's a very tiny window of information you can supply to them, past this window they start from scratch as if an elderly person with dementia.</div></div>
<p>That‚Äôs what **context **means for an LLM. he bigger the context size, the slower they get and they **all **have this limitation. They‚Äôll never get global-type of understanding to any codebase unless it is so tiny it fits entirely in their context, together with the much larger amount of reasoning of what it does, why it does it, etc.</p>

<p>Any LLM, even with the largest context windows available, fails precisely where humans excel. Context windows are limited. They can‚Äôt truly ‚Äúremember‚Äù beyond what‚Äôs in the current conversation. They can‚Äôt maintain the kind of deep, interconnected understanding that a human developer builds over time working with a codebase. They process text, not meaning. They see tokens, not systems.</p>

<p>This is where human coders will always prevail. Real software development isn‚Äôt about writing isolated functions. It‚Äôs about understanding complex systems, maintaining mental models of how everything fits together, and making decisions that consider the entire context of the project, its history, its future, and its constraints. LLMs can‚Äôt do this. They can only work with what‚Äôs explicitly in their context window, and even then, they don‚Äôt truly understand it.
<strong>Moral of the story:</strong> you cannot write professional code with an LLM. You can use it to test the feasibility of some ideas and that‚Äôs it.&lt;/blockquote&gt;</p>
<h2 id="the-professionals-approach-that-imho-should-be-the-gold-standard-on-llm-usage">The Professional‚Äôs Approach that IMHO should be the gold-standard on LLM usage</h2>

<p>So how do you use LLMs without destroying your career or your codebase?</p>

<p>First, <strong>assume their knowledge is based on inaccuracies</strong>. Don‚Äôt ask them if something is feasible. Direct them to code your idea, so you can see with your own eyes if it is and fix what it gets wrong.<strong>Never use LLMs as juries of what is possible</strong>. Never take their opinion. They aren‚Äôt people, <strong>they are all snake oil salesmen.</strong> Their job is to sound knowledgeable, not to produce actual knowledge. Do you think the guy at MediaMarkt has any clue of the actual power of an i7-13123 vs an AMD Ryzen 7 Gen 8 v2.5 (I just made up tha last part)? His job is neither to draw sillicon logic in ever shrinking transistor size, with an ever increasing set of instructions to process things ever quicker, using ever more complicated manufacturing processses. Nope, that‚Äôs not his job, his job is to sell.</p>

<p>So instead focus on making them do quickly the prototypes of ideas you had in your head. Think of it as a feedback loop overcharged of the ideas that you will ask yourself over a number of weeks, in just days or 24 hours. But ultimately the machine would answer them a lot quicker, just a lot less accurately and more constrained. The prototype you end up with is just one of hundreds of millions of possibilities. <strong>The box cannot think outside the box.</strong> YOU CAN.</p>

<h3 id="1-use-a-different-language-for-prototyping-one-you-dont-care-much-about">1. Use a Different Language for Prototyping one you don‚Äôt care much about</h3>

<p>Never use an LLM for the final programming language you‚Äôre going to use. Only use it for with shite error-ignoring-prone languages that you don‚Äôt get paid professionally to use anymore, like JavaScript (if that‚Äôs not your main language).</p>

<p>Why? This ensures your knowledge of your food-on-the-table language remains intact due to constant use <strong>unaided</strong>. It also avoids future <strong>licensing</strong> issues. Most importantly, it makes copy and paste between prototype and final product impossible.</p>

<p>So prototype ideas on a shite language, write them yourself on the proper one.
<img src="https://images.unsplash.com/photo-1692734207733-a79de344ff3a?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wxMTc3M3wwfDF8c2VhcmNofDQ2fHxzaGl0fGVufDB8fHx8MTc2NzM5MzU5M3ww&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=2000" alt="a red sign with a picture of a cow on it" /></p>
<h3 id="2-never-use-it-with-your-professional-language-or-the-one-you-feel-passionate-about">2. Never Use It With Your Professional Language or the one you feel passionate about</h3>

<p>If JavaScript is your professional language, use Python for prototyping. The separation is crucial.</p>

<p>Here‚Äôs my personal approach: JavaScript was my professional language for quite a while. I can still read it and code in React, Angular, React Native, or NativeScript when designing quick prototypes for Android, Angular was paying the bills. But I haven‚Äôt used it professionally in a very long time, nor do I think I will. My main **decent **languages that I get paid sustenance money for are Elixir, which I deeply love, and hopefully soon Kotlin, which finally covers the problems of Java‚Äôs obsessive OOP, and finally able to do what React Native had for me: multiplatform, thanks to Kotlin Multiplatform.</p>

<p><strong>I need to know what I‚Äôm doing with these languages,</strong> so no LLMs with them. Even better if you can use pseudocode for prototyping. Pseudocode lets you think through the logic and architecture without committing to any specific language, and then you can implement it properly in your professional language yourself. This maintains your skills while still allowing you to rapidly prototype ideas.</p>

<p>We need to compartmentalize: code we write from code LLMs produce. The best way is to use it to understand a concept, read through it, close the fucking tool, and force yourself to write from scratch the code yourself in that different language. As I said before: test the feasibility of ideas, never their actual implementation.</p>

<p>The main reason is the one I mentioned earlier, licensing issues. Imagine you work on a project, you worked aided by some LLM and then months down the line you discover your code comes (inevitably) from copyrighted code with an incompatible viral license to what you‚Äôve ‚Äúwritten‚Äù for someone else. I‚Äôm not talking about some for loop, I‚Äôm talking about those <strong>naive</strong> fake-fluencers trying to sell you books, seminars, and other bullshit, about completely code-free coding using agentic-mode only. There‚Äôs no way they aren‚Äôt ending up with large sections of ‚Äútheir‚Äù code being copyright-breaking material with lawyers in-waiting. This is going to probably end up being so big, these kinds of ads will have to be created with different banner ‚Äú<strong>has your code being used in a large codebase elsewhere, no win, no fee</strong>‚Äù.
<img src="/assets/images/2026-01-image-1.png" alt="Image" /></p>
<h3 id="3-use-local-models-when-possible">3. Use Local Models When Possible</h3>

<p>Swap for local models with tools like Ollama as soon as you can. But be VERY aware: they are a black box. Every line of code out of an LLM is code stolen from somewhere and that somewhere clearly has a license just as much as anything sucked by a commercial-provider. NEVER copy and paste.</p>

<p>Even with local models, you‚Äôre dealing with code that was trained on, <strong>always assume, copyrighted materia</strong>l. The licensing implications are enough to remember you cannot and should not use their code.</p>

<p>The local models have a big advantage: nothing leaves your PC. The code you write, using a commercial LLM, always end up on someone else‚Äôs server. Cursor has a setting to keep thinks locally, I assume that setting is misleading.<strong>Never put the code you write for one of your clients on LLMs but specially online ones.</strong> Assume the company behind it is harvesting your prompts for further refinement of the model, and that everything you enter on it, will be used by someone else later. You might be digging your grave.</p>

<h3 id="4-never-invest-in-this-tech">4. Never Invest in This Tech</h3>

<p>Don‚Äôt buy GPUs to use them locally, don‚Äôt get the greatest 64 GB Apple Sillicon laptop to try different models locally, unless you have the spare funds. Assume it‚Äôll vanish into thin air. Don‚Äôt put your value on requiring them. Never develop dependency on them.</p>

<p>Nothing depreciates faster than software, and this is clearly an unsustainable bubble on snakeoil sales-speech software.</p>

<p>You‚Äôve lived through Uber, Airbnb, and other venture capitalistic cunts. You know what OpenAI and others will do. This shit is cheap now, <strong>it‚Äôll cost 10 times more in the near future</strong>. They are burning through VC cash to get you hooked into it. Same as Uber did while destroying their local taxi competitors, and now they are pricier than local taxis. Same as Starbucks does opening multiple stores to asphyxiate the competitors. It‚Äôs all the same strategy: cheap now, gets you hooked, become a commodity, then raise the prices.</p>

<p>Don‚Äôt build your career or your projects on something that will become unaffordable once they‚Äôve eliminated the competition and you‚Äôre locked in.</p>

<p>The LocalLLM market is entirely different, and for certain do investigate on it for fun as much as you‚Äôd like as I think this sub-are of LLMs is what will eventually rise victorious.</p>

<h3 id="5-maintain-self-control">5. Maintain Self-Control</h3>

<p>All of this requires self control. How much of an adult are you? How much do you value your employability?</p>

<p>The temptation to use LLMs for ‚Äúreal‚Äù work is strong. Short term might feel like you can do one week‚Äôs worth of work in an couple of hours. But in the long term, it erodes your skills, creates technical debt, produces code that‚Äôs harder to maintain, and makes you dependent on a service that will become eventually either unaffordable to you or unusable due to licensing issues.</p>

<p>Think about this: if running a local LLM that produces anything near the quality of Cursor‚Äôs default model costs you a humongous debt in computer components, what incentive do the already existing commercial ones have to NOT eventually raise what they charge for it. They aren‚Äôt NGOs, they are all for-profit companies.</p>

<p>It‚Äôs a fad, it‚Äôll go and evolve into mini-local LLM models.</p>

<h2 id="conclussion-why-the-rubbish-image-and-why-our-future-is-safe">Conclussion, why the rubbish image and why our Future is Safe</h2>

<p>I don‚Äôt think professional software development is going anywhere in favour of machines doing it.</p>

<p>The people who will ignore this advice? Clearly those who don‚Äôt work professionally as coders. Professional developers understand that code isn‚Äôt just about making something work, it‚Äôs about making something work well, maintainably, and elegantly. It‚Äôs like raising a kid.</p>

<p>But I don‚Äôt think we‚Äôre through the worse yet. I think first, will come the commodifying of LLMs, getting as many people hooked as possible, second the hiking of the prices, third, the selling of the convenience of commercial ones compared to local LLMs, then legislation will FINALLY catch up (if ever) and burst the bubble of the commercial ones (that‚Äôs where the injury-lawyer industry re-focus will happen into <strong>some major copyright battles</strong>), then some local LLMs will become easier to understand and run, then there‚Äôll be probably more openness (enforced by the law, probably the EU first) about the source of LLMs ‚Äúknowledge‚Äù and finally purpose-built per coding-language and ecosystem language models. Tiny thematicals LLMs capable of requiring less power since they are focused on a single thematic task (like, future Jetpack Compose UI generators).</p>

<p>I‚Äôm expecting the bubbele to burst spectacularly and in a similar way the housing crash did since we‚Äôre humans, which means, our context window is neither infinite and love repeating our own mistakes. Every bank surely has directly or indirectly invested in this crap, and the moment OpenAI crash we‚Äôll have another Lehman Brothers moment
**OpenAI is the new Lehman Brothers &lt;/blockquote&gt;
Now, why that image? Because when I think of Sillicon Valley and Big Tech‚Ñ¢Ô∏è, that‚Äôs what comes to my mind: rubbish and people going through it, trying to find value. Yet instead of looking in the recyclable bin, where by definition it is easier to find something that worked in the past and refine it, they look into the non-recyclable one, the one filled with dog poo and cat litter, and try to sell it to us as The Cum of Christ, Microsoft is particularly guilty of this, no matter how many times people shout at them ‚ÄúI don‚Äôt want to eat a used diaper‚Äù they persistently repeat ‚Äúnow with Premium Poo‚Äùüëá</p>

<center><strong>No, thank you.</strong></center>

<p>LLMs are a tool. Like any tool, they‚Äôre useful for specific tasks and terrible for others. Use them for what they‚Äôre good at: rapid feasibility testing on disposable code. Don‚Äôt use them for what they‚Äôre bad at: actual software development.</p>

<p>Our future is safe because professional software development requires skills that LLMs simply won‚Äôt ever have due to their main limitation: context.</p>

<p>The developers who will thrive are the ones who understand this distinction and maintain their skills accordingly. The ones that will have to re-skill themselves into some other industry are those who fell for the vibe-coding fad.</p>

<p>Thanks for coming to my house, tip your waitress. Byyeeeee!</p>
<figure><iframe src="https://tenor.com/embed/5266957" frameborder="0"></iframe></figure>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="programming" /><category term="tools" /><category term="AI" /><summary type="html"><![CDATA[I tested Cursor, for prototyping ideas to just figure if they are feasible it works, yet for production level it doesn‚Äôt. Context is their kryptonite. Our jobs are VERY MUCH safe.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1571441249554.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1571441249554.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Living Out Loud With ADHD ‚Äì Episode 3: Elvanse long-term</title><link href="https://blog.maikel.dev/2026/01/02/living-out-loud-with-adhd-episode-3-elvanse-long-term.html" rel="alternate" type="text/html" title="Living Out Loud With ADHD ‚Äì Episode 3: Elvanse long-term" /><published>2026-01-02T00:00:00+01:00</published><updated>2026-01-02T00:00:00+01:00</updated><id>https://blog.maikel.dev/2026/01/02/living-out-loud-with-adhd-episode-3-elvanse-long-term</id><content type="html" xml:base="https://blog.maikel.dev/2026/01/02/living-out-loud-with-adhd-episode-3-elvanse-long-term.html"><![CDATA[<h1 id="some-necesary-background">Some necesary background</h1>

<p>Quick mandatory reminder üëá</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">‚ö†Ô∏è</div><div class="kg-callout-text">
    <p><strong>This is not medical information</strong>, nor am I a trained physician or any kind of expert in ADHD. I‚Äôm just another ADHDer untangling the data I got and detailing my own personal experience and effects (if any) of meds.</p>

    <p>If you think any of this relates to you, don‚Äôt take it on your own hands, discuss it with your doctor. If any of it particularly helped you or you think I might be on the wrong track feel free to let me know. Interactions are <strong>encouraged</strong>.</p>
  </div></div>

<h1 id="some-issues-ive-encountered-from-trying-to-operate-in-a-way-i-am-not-used-to">Some issues I‚Äôve encountered from trying to operate in a way I am not used to</h1>

<p>I think the main issue we‚Äôve got to discuss globally is the fact I‚Äôve functioned 39 years more or less succesffully without any medication. That means I have 39 years of workarounds and systems put in place, and behaviours to control what I thought was generic distractability and procrastination. For the most part, my ADHD only bothers me half the day when I‚Äôm not medicated, when these ways have exhausted my brain as even as hardcoded as they are, they are still forcing a machine to work in ways it shouldn‚Äôt be doing.</p>

<p><strong>The main good thing:</strong> On meds I start lots of things that I normally don‚Äôt even have the drive to start, and I would do them to completion, but in the path to that; <strong>the main bad thing:</strong> everything else gets accumulated.</p>

<h2 id="1-priorities-are-hard-to-measure-with-extra-dopamine">1. Priorities are hard to measure with extra dopamine</h2>

<p>Without any extra dopamine all tasks feel as if they have the same weight so when you try to trust your guts and do what ‚Äúfeels right‚Äù you‚Äôre indeed doing what reason tells you it is right.</p>

<p>With dopamine in abundance, that doesn‚Äôt work, what feel rights is actually a scale of different things, the ones you do enjoy have a much bigger weight and the ones that were reasonably important become somehow less so. It‚Äôs ridiculously easy to lose track on something you were even slightly passionate about and realise when it is too late in the day.</p>

<p>Deciding on priorities is a lot harder off the meds. I cannot stop a task until I finish it with meds, the problem is that task might not be the most important one for that day.</p>

<h2 id="2-the-sargentÔ∏è-is-missing-and-lifo-does-not-work">2. The Sargent‚Ñ¢Ô∏è is missing and LIFO does not work.</h2>

<p>Unmedicated I normally have this inner voice I call ‚ÄúThe Sargent‚Äù that reminds me what‚Äôs the main task I‚Äôm doing every few minutes and what other things I have to do, so I don‚Äôt lose track of what I‚Äôm doing with some distraction. That voice is gone now. So what keeps me on track is now passion, which is easy to let myself get carried away with.</p>

<p>So my days require a lot more planning because whatever I‚Äôm doing I‚Äôm going to lose track of any other thing I had to do that day unless I keep checking.</p>

<p>Normally, unmedicated LIFO (last-in, first-out) works, I can be doing a main task and distractions come in that are necessary to remove to carry on with main task. This stack scheduling does not work at all medicated. The stack just keeps getting bigger because I keep forgetting the main task and getting carried away. So the only thing that works for me is to outsource The Sargent.</p>

<p>I have a humongous Fish shell script that prints a banner with the main task, duration, when I stated and whenever I get distracted, I run another command from that script file to record the distraction. The whole system is markdown based and kept in my obsidian vault, except the Fish shell file.
<img src="/assets/images/2026-01-image-2.png" alt="Image" />
So today for that we get this, so far:
<img src="/assets/images/2026-01-image-3.png" alt="Image" />
Without this artificial version of The Sargent, I wouldn‚Äôt get anything done at all. So I‚Äôm introducing automation left and right to avoid making decisions the whole day and wasting hours on analysis paralysis.</p>

<p>I‚Äôm also going to rewrite this tool to remind me every 5 minutes of the task I‚Äôm doing instead, I just need to figure how to disable all other desktop notifications in the process.</p>
<details>
  <summary>Update on 7th of January of 2026</summary>

  <p>I made my script show this in the middle of the screen using Zenity every five minutes. I think as it is it could be useful to other people so <a href="https://gist.github.com/maikelthedev/9695bcec08f85e36a613c7bcbdc3cd09#file-add-distraction-fish-L691">here it is.</a></p>

  <h3 id="how-it-works">How it works</h3>

  <ol>
    <li>
      <p>My daily journals in Obsidian have a section called ‚ÄúWhat I do want from today‚Äù in there every day I write the main tasks I need to get done.</p>
    </li>
    <li>
      <p>In hyprland if I click Win+I it inserts a distraction, by asking me what is distracting me using Zenity for GUI creation from Fish shell.</p>
    </li>
    <li>
      <p>If none of the tasks are currently active, it‚Äôll ask me which one is the main one I‚Äôve been distracted from, once clicked, it‚Äôll mark when I started it.</p>
    </li>
    <li>
      <p>Every five minutes that box below will show on the screen, you can clearly change this, but 5 minutes is enough for me, i can get rid of it with a quick enter key press, no mouse needed. YES, I WANT IT AS INTRUSIVE as I normally am off meds, that‚Äôs how bad it gets on meds for me. I want it to mimic the behaviour of my internal scheduler.</p>
    </li>
    <li>
      <p>It creates urgency on the main task.</p>
    </li>
    <li>
      <p>I can move onto a new task by the shortcut Win+Ctrl+I, that runs ‚Äúnew-task‚Äù and writes on Obsidian the time it took to complete the previous one. If you have the right skin in Obsidian it‚Äôll change ‚Äú[/]‚Äù for ‚Äú[x]‚Äù and you‚Äôll notice it looks differnet, not all themes of Obsidian show ‚Äú[/]‚Äù different to ‚Äú[x]‚Äù. The ‚Äú[/]‚Äù exists to mark when a tasks is ongoing (not completed, but started). It‚Äôll also write there when I finished and how long it took.</p>
    </li>
  </ol>

  <p>It is incomplete but so far useful. Of course you can make the keys be whatever you want or use none and just call it from the terminal. The keys are not defined anywhere, they are just key bindings in my hyprland config to commands of the script.</p>

</details>

<p><img src="/assets/images/2026-01-image-7.png" alt="Image" /></p>
<h2 id="4-tyrosine-matters">4. Tyrosine matters</h2>

<p>This is plain simple, less than 1 gram of tyrosine supplementation per day and the effects of Elvanse (Medikinet too) were jerky or erratic. Get the gram of tyrosine (at least first thing together with the Elvanse) and the effect just maintains the whole day.</p>

<p>So now I‚Äôm force to supplement myself with tyrosine. At least is cheap.</p>

<h2 id="5-sleeping-is-better-but-more-rigid-in-some-ways-and-flexible-in-others">5. Sleeping is better but more rigid in some ways and flexible in others</h2>

<p>I‚Äôm slowly realising I can sleep anytime, at any moment when I want to do so, but under some rules. Being able to put the mind in blank is the main rule, which I can do under the effect of the meds. Once the effect starts to fade it becomes increasingly harder.</p>

<p>It doesn‚Äôt matter much when I wake up, what I‚Äôm realising matters <strong>the most</strong> is that I stay consistent in the time I take the pill. I can take it at 7am every day and still go back to sleep. If I don‚Äôt, and I take it whenever I wake up and that time is noon, I‚Äôm going to struggle to go to sleep early that day, and then we enter a vicious circle of taking the pill each day later and going to sleep later. So taking the medication at the exact same time every day is crucial, more so than waking up every day at the same hour.</p>

<p>So now I have the pill prepared with a lot of water by the bed with the tyrosine.</p>

<h2 id="6-discovering-im-a-workaholic-and-how-this-is-negative">6. Discovering I‚Äôm a workaholic and how this is negative</h2>

<p>I‚Äôve got lots of drive but in too many directions which generates procrastination by analysis paralysis. I want to:</p>

<ul>
  <li>go to the gym</li>
  <li>lose fat (not weight)</li>
  <li>have a sleep schedule</li>
  <li>work</li>
  <li>study something new</li>
  <li>learn Kotlin</li>
  <li>code Sparkr</li>
</ul>

<p>Each one of those have sub-tasks, and trying to do them without a system to set priorities nor The Sargent‚Ñ¢Ô∏è is close to impossible. I end up picking up one and sticking to it most of the day completely forgetting of the existence of the other ones.</p>

<h2 id="7-the-rulebook-changes-in-winter-with-less-sun">7. The rulebook changes in winter with less sun</h2>

<p>A seasonal-affective disorder (SAD) light is not optional. It‚Äôs mandatory if I want to work the whole day with the big PC. I might feel i have enough energy but nope, if I don‚Äôt keep it on most of the day (it‚Äôs a small one) then I‚Äôm going to feel tired at lot earlier. At least during winter or while living in a dark place, which I am, at the moment.</p>

<h2 id="8-task-lock-awareness-or-excessive-drive-actually-has-a-name">8. Task lock awareness or excessive drive actually has a name</h2>

<p>This is connected with number 1 and number 3 and it‚Äôs part of the <a href="https://en.wikipedia.org/wiki/Default_mode_network">default-mode network</a>. That‚Äôs an area of the brain ADHDers have overdeveloped, and is in charge among many other things of the voice (or voices) we hear on our minds while we think.</p>

<p>That voice is my scheduler, with it going quiet or having zero independence, I lose the ability to realise I‚Äôve been hours on the same task. It‚Äôs also the reason I can‚Äôt stand methylphenidate since it makes that voice completely silent while lisdexamphetamine give me more flexibility with it. At the same time, I feel like I‚Äôm so used to having ‚ÄúThe Sargent‚Äù that internally I keep fighting the effects of the pill and if it weren‚Äôt for the total emotional regulation I would rather never take these meds.</p>

<h2 id="9-the-role-of-the-time-the-pill-is-taken-and-how-your-reward-system-is-different">9. The role of the time the pill is taken and how your reward system is different</h2>

<p>Going to the gym is a nightmare on Elvanse because it makes me sweat thrice as much and be a lot thirstier. Unfortunately taking it after the gym is impossible, because without it, I simply never leave the bed. Elvanse sets a new baseline for what ‚Äúminimum energy levels‚Äù is required to jumpstart your day. This is why I rather take it and go back to bed, than wait until I‚Äôm fully awake and then take it.</p>

<p>While unmedicated, I just wake up and go to the gym. Every task feels the same ( = nothing) until I am actually finishing the task and THEN I get my dopamine reward. I get the motivation to go to the gym from chasing that high, the one I get when I hit the shower and I know I completed my workout, not from working out itself.</p>

<p>With Elvanse, this reward system is heavily modified. When I‚Äôm there I‚Äôm only there, I forget to even play music on my headphones. When I lift, I compete strongly with what I normally can lift, a lot more than usual. But on Elvanse working out is no longer something I do chasing the joy of having done it, but something that I do chasing the knowledge that I‚Äôm killing records. Which means a lot more ego-lifting than usual and I have to <strong>re-calibrate</strong> constantly to remember I‚Äôm on Elvanse and my perception of max weight is not what it‚Äôs healthy.</p>

<h2 id="10-bullet-time-is-gone">10. Bullet time is gone</h2>

<p>Remember that bullet time thing you got at the beginning on Elvanse, that‚Äôs long gone. Not because suddenly time has slowed down, but because you are so long with it that you stop perceiving the difference. The days I do not take the meds, time feels nearly the same too, you do notice it flies quicker but still doesn‚Äôt feel as before the meds.</p>

<h2 id="11-still-got-adhd-issues-just-different-ones">11. Still got ADHD issues just different ones</h2>

<ul>
  <li>Procrastination is gone, I can do whatever I want at all times, in exchange I have a harder time to figure what I want.</li>
  <li>I‚Äôm getting messier, without a voice in my head reminding me stuff I keep forgetting keys, buying groceries, cleaning the house. This is a common ADHD issue but I don‚Äôt have it off meds because I weaponized that internal distracting voice into what I call The Sargent.</li>
  <li>Setting priorities is very hard.</li>
  <li>My time perception is awful now.</li>
  <li>I have working memory issues always on meds, I can‚Äôt hold unrelated data in my mind.</li>
</ul>

<h2 id="12-what-happens-on-rest-days-and-why-i-cant-be-more-than-2-days-without-meds">12. What happens on rest days and why I can‚Äôt be more than 2 days without meds.</h2>

<p>The positives:</p>

<ul>
  <li>I can hold humongous amount of unrelated data</li>
  <li>The Sargent is back, I don‚Äôt need TO-DO lists anymore.</li>
  <li>Global views on source code are easier to maintain.</li>
  <li>I can code in my head.</li>
  <li>I‚Äôm a lot more aware of my body and sensations.</li>
  <li>Going to the gym and enjoying it is a lot easier because I‚Äôm used to delayed rewards.</li>
</ul>

<p>The negatives:</p>

<ul>
  <li>They all happen in the afternoon</li>
  <li>I‚Äôm exhausted, mentally exhausted.</li>
  <li>I‚Äôm incredibly hungry, and overeat.</li>
  <li>Noise is a nightmare, especially when there‚Äôs too much and is unpredictable. Is like being in twitchy, jumpy mode.</li>
  <li>I can‚Äôt sleep, I have no control of my default-mode network. I can only sleep by physical exhaustion.</li>
  <li>I‚Äôm very irritable with everyone around me and spending humongous amounts of mental energy trying to not get irritated for things that I know shouldn‚Äôt bother me that much.</li>
  <li>I can‚Äôt stop yawning.</li>
  <li>Out-of-nowhere anxiety starts crippling in, a baseline anxiety that I had my entire life off-meds and I don‚Äôt have in the slightest on meds. Financial worries are the biggest ones crippling in. While on meds, I can focus on finding solutions instead of constantly enumerating the problems in my head.</li>
</ul>

<p>The negatives don‚Äôt happen the first day off meds, they start to happen toward the ending of the 2nd day meds free, and they always come with an immediate and huge craving for caffeine.</p>

<h2 id="13-i-tried-splitting-my-dosages-and-it-only-gives-me-anxiety">13. I tried splitting my dosages and it only gives me anxiety</h2>

<p>I have all the crazy chemistry doctor material to split my Elvanse dosages in whatever amounts of mutiple of 10 miligrams. Nothing works. It‚Äôs got to be 50mg, any less than 50mg and all I have is anxiety. Only 50 reaches the threshold to build up the necessary dopamine to have more positives than negatives. Thirty only works when I‚Äôve woken up really late and take it in the afternoon.</p>

<p>This has made me consider the option of changing into 30mgs and spending half day off meds, the other half with meds so I get to enjoy my favourite ‚Äúme‚Äù format. But it‚Äôs jerky. 30mg works when it‚Äôs the pills, when it‚Äôs the split dosage, it can keep me awake at night. I‚Äôm not going to spend 83‚Ç¨ on 30mg pills.</p>

<h2 id="14-bad-trips">14. Bad trips</h2>

<p>Not all days are perfect, some days I have really really bad effect and the memory issues are even worse. Then the inability to stretch my attention span enough to remember what I‚Äôm doing starts to make me feel anxious. The worst day this happened, it literally feels like having early-onset Alzheimer. It took me 3 hours to remember the main task I was doing was moving the shoes from mine and Remi‚Äôs bedroom into the entrance shoes cabinet. Can you imagine the desparation of seeing the time fly while you spend it trying to remember what were you doing? You don‚Äôt have even short-term memory enough to be able to reach a notepad or Obsidian to write it.</p>

<p>It fucks my short-term memory more than my working one. But, as I said, that‚Äôs on the odd bad trip day which usually happen before I decide to take a couple of days off the meds. Those days are usually the reason I‚Äôd rather stop the meds altogether or even try the 30mg option. But right now what I‚Äôm studying the most is the modifying power of naps since that will dictate in the near future my dosage or even choice of med.</p>

<h2 id="15-why-i-find-cycling-meds-on-and-meds-off-is-so-necessary">15. Why I find cycling meds on and meds off is so necessary?</h2>

<p>Memory. Each state of mind (med/unmed) changes the way my memory works and what I have more easily accessible. I tend to forget the cons of being unmedicated after long time medicated, and the same happens the other way. Both are bad. None are optimal. The solution is <strong>definitely</strong> going to be self-directed cognitive-behavioral therapy (CBT) which I‚Äôm already doing every time I write this posts.</p>

<p>The key to figure out my strength, weakness and behavioral patterns I need to change is to figure which ones worked and which ones didn‚Äôt. I only get that perspective swapping from one to the other. Everything I learn while medicated is stuff I apply later unmedicated with the hope of eventually stopping meds altogether.</p>

<h1 id="what-ive-learnt-so-far-that-will-eventually-help-me-take-no-meds">What I‚Äôve learnt so far that will eventually help me take no meds.</h1>

<h2 id="1-what-i-thought-were-distractions-were-actually-necessary-aids-to-keep-focus">1. What I thought were distractions were actually necessary aids to keep focus</h2>

<p>I do watch a shitload of TV and can‚Äôt do anything without music in the background. The gym is the moment of the day where I go through my ‚Äúdiscovery weekly‚Äù playlist and classify what I like from what I don‚Äôt. I‚Äôm normally following the rhythm of the music when I do so. I don‚Äôt think about it, I just do. It‚Äôs <strong>the background task</strong> that keeps me focused. The passive thing you do without paying much attention to it, that somehow keeps the most distracting inner dialogue from focusing on‚Ä¶distracting me.</p>

<p>On medication watching TV bores me, but because it normally does and I can do it without paying much attention to it. Medicated it becomes the main task and is simply not enough interesting.</p>

<h2 id="2-the-sargentÔ∏è-has-a-cost">2. The Sargent‚Ñ¢Ô∏è has a cost</h2>

<p>Maintaining the voice that every couple of minutes reminds me of what I have to do, to take the keys when going out, that the house is filthy, that I need to shower, that the fridge is empty‚Ä¶is the main reason my brain gets exhausted. I cannot turn it off unmedicated, too many years of practice.</p>

<p>But I can refrain from feeding it by writing down what I‚Äôve got to do. This sounds easier than it is, because that voice is capable of sorting out priorities and take quick decisions on the fly, while writing down implies doing all that in advance and learning which tasks shouldn‚Äôt need remembering.</p>

<h2 id="3-the-humongous-working-memory-or-internal-blackboard-also-has-a-cost">3. The humongous working memory or internal blackboard also has a cost</h2>

<p>I can code in my head, I can explore solutions without typing a single line. Together with the sargent this has another humongous costs and is probably the reason I get mentally exhausted by the afternoon. While I‚Äôm fine I don‚Äôt even feel any effort in doing this I just keep getting progressively tired until at some point of the day, its gets a life of its own and feels like being enclosed in the Architect room of The Matrix with all the screens as the same volume claiming for your attention.</p>

<p>Again, the solution is of course to use it less, but how do you do that when it feels effortless to use. It‚Äôs easy in the case of the sargent, but maintaining humongous abstractions gives you a lot of speed. Is like running a full OS from RAM instead of hard drive.</p>

<p>This is the main thing I need to fix to be pill free. And so far all I‚Äôve got is that I don‚Äôt have access to either while medicated. e.g: the abstractions on meds can be just as large but they are thinner, more specific, less global. Without meds I don‚Äôt need to re-read this entire article to avoid repeating myself, I would know what I wrote, while medicated I do because each paragraph is a different issue.</p>

<p>And none of that is giving me yet a clue on how to avoid using the full available bandwidth unmedicated. So far all I got is that I can reset it by having a nap.</p>

<h2 id="4-napping-is-the-key-to-everything">4. Napping is the key to everything</h2>

<p>When I was a kid, something that I can only remember on meds because it expands the access and reach of my long-term memory, is that every afternoon I could spend ~4 hours sitting on sofa with nothing but myself, I wasn‚Äôt bored, nor I had my eyes closed, even though I surely would have loved to do so and fall sleep and indeed sometimes I did, I was just letting go.</p>

<p>When I reached exhaustion and was overwhelmed by my own brain I just relaxed by becoming an spectator. There was nothing to fear, I‚Äôve always known in the afternoon that I would feel exhausted until I got my second wind. What I didn‚Äôt know until the diagnose is that it was untreated ADHD the reason.</p>

<p>So I would just sit comfortably in the nicest sofa around in my home and daydream until I eventually had a short nap or the exhaustion vanished.</p>

<p>The thing is on meds, I can just fall anytime. I‚Äôm definitely planning to do so after finishing this awful thing that is already consuming 6 hours of my time.
<img src="/assets/images/2026-01-image-4.png" alt="Image" />
But without meds I cannot. So I need to figure how to transfer that skill from medicated to unmedicated. Because if I can have a nap then I can be unmedicated and in the right side of my ADHD symptoms the whole day.</p>

<h2 id="5-memory-might-not-be-erratic-just-different">5. Memory might not be erratic just different</h2>

<p>Remember what I‚Äôve just written, on medication I can remember things from the very-long-ago past better while my short-term and working memory are normally limited, while other days the short-term is kind of frustratingly non-existent.</p>

<p>But what if that‚Äôs what‚Äôs normal.</p>

<p>I have the theory that I‚Äôve somehow specialised my brain in recycling the space for long-term memory in exchange for a bigger daily working memory. I notice same I can remember with 10x more detail what happened around the city where I live, street names, where to find stuff, etc from the most immediate past, I erase the stuff I don‚Äôt care about from the far past very quickly while everybody around me can remember stuff from their childhood that I do not and for them is not normal I cannot, while for me, it is. e.g.: each generation has a cartoon they were addicted to, mine was Dragon Ball. I can‚Äôt barely remember anything about it, not even names, while Adrian that is my same generation can tell me entire plotlines. And I do know I was addicted to those cartoons but I know it is information I did not care at all about storing.</p>

<p>I‚Äôm yet to meet someone else that can semi-consciously decide what information to delete.</p>

<h2 id="6-emotional-disregulation-is-100-tied-to-mental-exhaustion">6. Emotional disregulation is 100% tied to mental exhaustion</h2>

<p>Once I cannot control my inner monologue, I can‚Äôt do anything at will other than rest. So my body becomes this 1-goal zombie that only wants one thing: to rest. And anyone standing in the way between me and rest <strong>they‚Äôre going to get run over</strong> and there‚Äôs nothing I can do about it other than subtract myself from their presence as I‚Äôm a ticking bomb with no control over what they say to be left alone and sleep.</p>

<h2 id="7-decision-fatigue-is-a-big-issue">7. Decision fatigue is a big issue</h2>

<p>The Sargent does spend a humongous amount of energy moving priorities. In this sense there‚Äôs a feedback loop between it and the abuse of the bandwidth of my working memory. You can take better decisions when you have as many possibilities displayed in your mind‚Äôs eye as possible.</p>

<p>The solution is to delegate. To who? To me in the past. Decide ahead of the future, in small chunks. Avoid my daily routine to have menial decisions. Decisions are decisions big or small, the less you take, the less decision fatigue. If I can get rid off the smaller ones, then I‚Äôm further from suffering it.</p>

<p>Also, just doing what‚Äôs right instead of what‚Äôs optimal helps. What‚Äôs optimal never gets an immediate answer, what‚Äôs right always does.</p>

<h2 id="8-measure-times">8. Measure times</h2>

<p>I‚Äôm making tasks that take really little time a lot longer by overthinking them, I should be measuring how long do they take me and challenge that timing.</p>

<h2 id="9-small-increments">9. Small increments</h2>

<p>Only small changes stick but they have to be so simple and dumbed down that they are effortless. Like, instead of focusing on trying to wake up to go to the gym, focus on not taking the pill at 7am independently of leaving the bed or carrying on sleeping.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In a nutshell meds-free life is going to be:</p>

<ul>
  <li>Learning to not abuse and instead protect my bandwidth, by using it as little as possible, and changing ways I do stuff to save it for when I actually need it. e.g.: actually writing to-do lists.</li>
  <li>avoid analysis paralysis and decision fatigue as anything involving this, will undoubtedly make me think globally.</li>
  <li>Use meds as a tool to build new systems, then lean on external scaffolding. Don‚Äôt rely on internal memory or the ‚ÄúSargent‚Äù voice.</li>
  <li>Cycle between medicated and unmedicated states to test what works and learn from each mode.</li>
</ul>

<p>Manage mental energy smarter: naps, pacing, and avoiding afternoon crashes that make meds <strong>be</strong> necessary.</p>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="ADHD" /><summary type="html"><![CDATA[My experience with ADHD and what has been working so far ever since starting on medication. This episode is about the usage of Elvanse long-term.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1675524375084.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1675524375084.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">A Coru√±a, primera zona tensionada de Galicia: gu√≠a pr√°ctica de precios, contratos y obligaciones</title><link href="https://blog.maikel.dev/2025/10/21/a-coruna-primera-zona-tensionada-de-galicia-guia-practica-de-precios-contratos-y-obligaciones.html" rel="alternate" type="text/html" title="A Coru√±a, primera zona tensionada de Galicia: gu√≠a pr√°ctica de precios, contratos y obligaciones" /><published>2025-10-21T00:00:00+02:00</published><updated>2025-10-21T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/10/21/a-coruna-primera-zona-tensionada-de-galicia-guia-practica-de-precios-contratos-y-obligaciones</id><content type="html" xml:base="https://blog.maikel.dev/2025/10/21/a-coruna-primera-zona-tensionada-de-galicia-guia-practica-de-precios-contratos-y-obligaciones.html"><![CDATA[<p>A Coru√±a se ha convertido en la <strong>primera ciudad gallega declarada zona de mercado residencial tensionado</strong> por el <strong>alto precio del alquiler</strong>.
La medida, enmarcada en la <strong>Ley 12/2023 por el Derecho a la Vivienda</strong>, busca frenar la escalada de precios y mejorar el acceso a la vivienda, especialmente en barrios donde el coste del alquiler se ha disparado por encima del 30 % de los ingresos familiares.</p>

<p>A partir de ahora, <strong>inquilinos y propietarios deber√°n adaptarse a un nuevo marco legal</strong> que incluye un √≠ndice de precios de referencia, l√≠mites para grandes tenedores y beneficios fiscales para los peque√±os arrendadores que ajusten las rentas.</p>
<hr />

<h2 id="-el-nuevo-sistema-estatal-de-referencia-de-precios-de-alquiler">üìä El nuevo Sistema Estatal de Referencia de Precios de Alquiler</h2>

<p>Una de las principales herramientas de esta regulaci√≥n es el <strong>Sistema Estatal de Referencia de Precios de Alquiler de Vivienda</strong>, creado por el Ministerio de Vivienda.
Esta aplicaci√≥n oficial permite conocer el <strong>precio de referencia</strong> de una vivienda a partir de datos tributarios sobre arrendamientos habituales, considerando superficie, ubicaci√≥n, antig√ºedad, estado o eficiencia energ√©tica.
<strong>üí° Ejemplo: para un piso de 90 m¬≤ en A Coru√±a, el precio de referencia puede variar desde **377 ‚Ç¨ en Agra do Orz√°n</strong> hasta <strong>825 ‚Ç¨ en la plaza de Lugo</strong>.&lt;/blockquote&gt;&lt;hr&gt;</p>
<h2 id="-cuadro-de-precios-orientativos-por-zonas-vivienda-tipo-de-90-m">üìç Cuadro de precios orientativos por zonas (vivienda tipo de 90 m¬≤)</h2>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">**ATENCION INQUILINOS**
En esta web si metes la direcci√≥n de tu casa te dice cuanto te pueden cobrar como m√°ximo. [https://serpavi.mivau.gob.es/](https://serpavi.mivau.gob.es/)</div></div>
<!--kg-card-begin: html-->
<table>
<thead>
<tr>
<th>Zona / Barrio</th>
<th>Rango de precio (‚Ç¨)</th>
<th>‚Ç¨/m¬≤ aprox.</th>
<th>Comentario</th>
</tr>
</thead>
<tbody>
<tr>
<td>**Plaza de Lugo (Centro ‚Äì Ensanche)**</td>
<td>616 ‚Äì 825 ‚Ç¨</td>
<td>6,8 ‚Äì 9,2 ‚Ç¨/m¬≤</td>
<td>M√°xima presi√≥n de precios; escasa oferta y alta demanda.</td>
</tr>
<tr>
<td>**Calle San Andr√©s (Centro hist√≥rico)**</td>
<td>555 ‚Äì 746 ‚Ç¨</td>
<td>6,2 ‚Äì 8,3 ‚Ç¨/m¬≤</td>
<td>Zona prime, mucha rotaci√≥n y presencia de alquiler tur√≠stico.</td>
</tr>
<tr>
<td>**Monte Alto ‚Äì Ronda de Monte Alto**</td>
<td>432 ‚Äì 544 ‚Ç¨</td>
<td>4,8 ‚Äì 6,0 ‚Ç¨/m¬≤</td>
<td>En auge, buena relaci√≥n precio-ubicaci√≥n.</td>
</tr>
<tr>
<td>**Riazor ‚Äì Ciudad Escolar**</td>
<td>509 ‚Äì 707 ‚Ç¨</td>
<td>5,6 ‚Äì 7,8 ‚Ç¨/m¬≤</td>
<td>Alta demanda, especialmente en pisos peque√±os y reformados.</td>
</tr>
<tr>
<td>**Os Castros ‚Äì Castrill√≥n**</td>
<td>419 ‚Äì 565 ‚Ç¨</td>
<td>4,6 ‚Äì 6,3 ‚Ç¨/m¬≤</td>
<td>Alternativa media con precios m√°s contenidos.</td>
</tr>
<tr>
<td>**Agra do Orz√°n**</td>
<td>377 ‚Äì 536 ‚Ç¨</td>
<td>4,2 ‚Äì 5,9 ‚Ç¨/m¬≤</td>
<td>Zona popular y densamente poblada; √≠ndice m√°s bajo del centro urbano.</td>
</tr>
<tr>
<td>**Sagrada Familia**</td>
<td>319 ‚Äì 468 ‚Ç¨</td>
<td>3,5 ‚Äì 5,2 ‚Ç¨/m¬≤</td>
<td>Mercado asequible y tradicional.</td>
</tr>
<tr>
<td>**Novo Mesoiro**</td>
<td>444 ‚Äì 528 ‚Ç¨</td>
<td>4,9 ‚Äì 5,8 ‚Ç¨/m¬≤</td>
<td>Barrio joven y en expansi√≥n, con buena oferta familiar.</td>
</tr>
</tbody>
</table>
<!--kg-card-end: html-->
<p><strong>üìà El precio medio actual del mercado en A Coru√±a ronda los **730 ‚Ç¨/mes</strong>, seg√∫n el Instituto Galego de Vivenda e Solo (IGVS).
En portales como Idealista, <strong>dos tercios de los pisos en oferta superan los 900 ‚Ç¨</strong>, lo que confirma la brecha entre la realidad del mercado y el √≠ndice estatal.&lt;/blockquote&gt;&lt;hr&gt;</p>
<h2 id="Ô∏è-qui√©n-debe-aplicar-el-√≠ndice-de-referencia">‚öñÔ∏è Qui√©n debe aplicar el √≠ndice de referencia</h2>

<p>Seg√∫n la Ley de Vivienda, el <strong>√≠ndice no afecta a todos los propietarios por igual</strong>:</p>

<ul>
  <li>Grandes tenedores (due√±os de m√°s de 10 viviendas) deben ajustarse obligatoriamente al √≠ndice al firmar un nuevo contrato en una zona tensionada.</li>
  <li>Peque√±os propietarios solo deben hacerlo si:Firman un nuevo contrato en una zona tensionada, y</li>
  <li>El piso no ha estado alquilado en los √∫ltimos 5 a√±os.</li>
</ul>
<p>&lt;/li&gt;&lt;/ul&gt;
El Ministerio no fija un precio √∫nico, sino una <strong>horquilla m√≠nima y m√°xima</strong>, que permite flexibilidad seg√∫n las caracter√≠sticas del inmueble (planta, antig√ºedad, certificaci√≥n energ√©tica, etc.).</p>
<hr />

<h2 id="-reglas-clave-de-los-contratos-en-zonas-tensionadas">üè† Reglas clave de los contratos en zonas tensionadas</h2>

<h3 id="1-limitaci√≥n-de-rentas">1. Limitaci√≥n de rentas</h3>

<ul>
  <li>Si el piso ya estaba alquilado en los √∫ltimos 5 a√±os, el nuevo contrato no puede superar la renta anterior actualizada con el √≠ndice permitido.</li>
  <li>Si nunca se alquil√≥ o lleva m√°s de 5 a√±os vac√≠o, el precio m√°ximo ser√° el del √≠ndice estatal correspondiente.</li>
</ul>

<h3 id="2-actualizaci√≥n-anual">2. Actualizaci√≥n anual</h3>

<ul>
  <li>En 2025, la subida m√°xima ser√° del 3 %.</li>
  <li>A partir de 2026, se aplicar√° un nuevo √≠ndice (a√∫n pendiente de definir).</li>
</ul>

<h3 id="3-duraci√≥n-y-pr√≥rrogas">3. Duraci√≥n y pr√≥rrogas</h3>

<ul>
  <li>Contratos de 5 a√±os (propietarios particulares) o 7 a√±os (personas jur√≠dicas).</li>
  <li>En zonas tensionadas, el inquilino puede pedir una pr√≥rroga adicional de hasta 3 a√±os, salvo causa justificada de necesidad del propietario.</li>
</ul>

<h3 id="4-registro-auton√≥mico">4. Registro auton√≥mico</h3>

<ul>
  <li>Todos los contratos deben inscribirse en el registro de arrendamientos de Galicia.</li>
  <li>La Xunta podr√° inspeccionar y sancionar incumplimientos del l√≠mite de precios.</li>
</ul>
<hr />

<h2 id="-beneficios-fiscales-e-infracciones">üí∞ Beneficios fiscales e infracciones</h2>

<h3 id="incentivos">Incentivos</h3>

<p>Los propietarios que ajusten el precio a los l√≠mites y ofrezcan estabilidad pueden obtener <strong>bonificaciones de hasta el 90 % en el IRPF</strong> por los ingresos del alquiler, siempre que cumplan con los requisitos de duraci√≥n y referencia del √≠ndice.</p>

<h3 id="sanciones">Sanciones</h3>

<p>El incumplimiento de la normativa puede acarrear consecuencias graves:</p>

<ul>
  <li>Multas de hasta 60.000 ‚Ç¨ por infracciones muy graves.</li>
  <li>Nulidad de las cl√°usulas abusivas.</li>
  <li>P√©rdida de beneficios fiscales aplicados indebidamente.</li>
  <li>Inspecci√≥n y sanci√≥n administrativa si se detectan rentas fuera del √≠ndice.</li>
</ul>
<hr />

<h2 id="-impacto-en-el-mercado-de-a-coru√±a">üîç Impacto en el mercado de A Coru√±a</h2>

<p><strong>Efectos esperados:</strong></p>

<ul>
  <li>Mayor transparencia en los precios.</li>
  <li>Incentivo para rehabilitar viviendas vac√≠as.</li>
  <li>Estabilidad para inquilinos y previsibilidad para propietarios.</li>
</ul>

<p><strong>Riesgos a vigilar:</strong></p>

<ul>
  <li>Reducci√≥n temporal de la oferta.</li>
  <li>Aumento del alquiler tur√≠stico o de habitaciones.</li>
  <li>Desplazamiento de la demanda a municipios cercanos (Oleiros, Culleredo, Arteixo).</li>
</ul>
<hr />

<h2 id="-conclusi√≥n">üß≠ Conclusi√≥n</h2>

<p>Con la declaraci√≥n de A Coru√±a como zona tensionada, la ciudad entra en una nueva etapa del mercado del alquiler.
La regulaci√≥n busca equilibrio entre protecci√≥n al inquilino y sostenibilidad para los propietarios, pero el √©xito depender√° de su aplicaci√≥n pr√°ctica y del control efectivo por parte de las administraciones.
<strong>En definitiva: la vivienda en A Coru√±a no solo se regular√° por la oferta y la demanda, sino tambi√©n por un **marco normativo que fija l√≠mites, incentiva la rehabilitaci√≥n y penaliza los abusos</strong>.
Un cambio estructural que marcar√° los pr√≥ximos a√±os del mercado inmobiliario gallego.&lt;/blockquote&gt;</p>
<h1 id="mas-informaci√≥n">Mas informaci√≥n</h1>

<ul>
  <li>P√°gina de la cual copie el contenido porque yo lo valgo y porque nada toca mas los huevos que una p√°gina creyendo que puede decidir que yo no pueda copiar y pegar.</li>
  <li>Precios cogidos de este art√≠culo de La Opini√≥n de Coru√±a</li>
  <li>Tambien de esta otra</li>
</ul>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="real-estate" /><category term="Spain" /><category term="Coru√±a" /><summary type="html"><![CDATA[En este art√≠culo te explico, de forma clara y pr√°ctica, qu√© significa exactamente que A Coru√±a sea zona tensionada, qu√© limitaciones introduce y c√≥mo puede afectarte tanto si ya tienes una vivienda alquilada como si planeas ponerla en el mercado.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1679432494197.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1679432494197.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Loading all environment variables from Bitwarden on terminal launch without noticeable lag</title><link href="https://blog.maikel.dev/2025/10/21/loading-all-environment-variables-from-bitwarden-on-terminal-launch-without-noticeable-lag.html" rel="alternate" type="text/html" title="Loading all environment variables from Bitwarden on terminal launch without noticeable lag" /><published>2025-10-21T00:00:00+02:00</published><updated>2025-10-21T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/10/21/loading-all-environment-variables-from-bitwarden-on-terminal-launch-without-noticeable-lag</id><content type="html" xml:base="https://blog.maikel.dev/2025/10/21/loading-all-environment-variables-from-bitwarden-on-terminal-launch-without-noticeable-lag.html"><![CDATA[<h1 id="the-problem-im-trying-to-solve">The problem I‚Äôm trying to solve</h1>

<p>If you use Bitwarden you might have tried using <a href="https://bitwarden.com/help/cli/">Bitwarden CLI</a> which is a nightmare of a tool clearly not fit for purpose.</p>

<p>The main problem with it is that it takes between 1 to 5 seconds for every value you retrieve. The secondary problem is that unlike any other official Bitwarden implementation it is impossible to remain logged in without writing your own scripts to store BW_SESSION (logging with api credentials), pass it between shell sessions or make it universal and still make it so that it tests it works and relogs again if the session token has expired. Considering this again costs between 1 to 5 seconds it is too much time to waste whenever you open a new terminal.</p>

<p>I use <a href="https://fishshell.com/">Fish shell</a>, it‚Äôs been my favourite shell for more than ten years, it does stuff that all other shells should be doing now without plugins required. In Fish shell when you make a universal environment variable with <code class="language-plaintext highlighter-rouge">set -U VARIABLE</code>, it doesn‚Äôt magically get into the ether or stored in memory, it gets writen on the filesystem on <code class="language-plaintext highlighter-rouge">$HOME/.config/fish/fish_variables</code> and I definitely don‚Äôt want that there.</p>

<p>So we have two problems, on one side the official bitwarden cli takes ages with any command, and on the other side I don‚Äôt want to keep the session alive by writing the token to a file anywhere on my system.</p>

<h1 id="rbw-entered-the-room">RBW entered the room</h1>

<p>The program <code class="language-plaintext highlighter-rouge">rbw</code> is a command-line tool that does the same job as Bitwarden-CLI albeit very **very **differently. To begin with the commands are not the same, and the way you search for stuff is not the same either. But the most important value of <code class="language-plaintext highlighter-rouge">rbw</code> is that it maintains the connection logged unlike the official CLI tool.</p>

<p>It has a small issue, which is that it doesn‚Äôt accept <a href="https://github.com/doy/rbw/issues/292#issuecomment-3425564942">Webauth/FIDO2 as 2FA right now</a> but you can bypass this issue enabling any of the other accepted 2FA ways. In fact I enabled TOTP and it worked beautifully, I was asked for the temporal number combo only once the first time. You can use bitwarden itself as TOTP generator for this since you already have other login mechanisms for it.</p>

<p>That done, one problem was solved, login with <code class="language-plaintext highlighter-rouge">rbw</code> is very easy after installing it, if you use Bitwarden‚Äôs official vault, same as I do, do not forget the <code class="language-plaintext highlighter-rouge">register</code> command as explained in the <a href="https://github.com/doy/rbw">rbw repo</a> also if you use Nixos add <code class="language-plaintext highlighter-rouge">pinsentry-tty</code> to your packages, not <code class="language-plaintext highlighter-rouge">pinsentry</code> not any GUI version, you want the one for the terminal . Then do:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># To configure it</span>
rbw config <span class="nb">set </span>email your@ema.il
<span class="c"># Lock timeout in seconds, I prefer 16 hours, covers the time I'm awake</span>
rbw config <span class="nb">set </span>lock_timeout <span class="si">$(</span>math <span class="s2">"60*60*16"</span><span class="si">)</span>
<span class="c"># To log in</span>
rbw login
</code></pre></div></div>

<p>And that‚Äôs it. You don‚Äôt need to do anything else. Any changes in config will ask you to login again the next time you try to get anything out of Bitwarden. With this we‚Äôve solved the second problem, keeping environment variables anywhere on our system to stay connected.</p>

<h1 id="next-issue-rbw-speed-has-limits">Next issue: RBW speed has limits</h1>

<p>So imagine I want to set up a function called <code class="language-plaintext highlighter-rouge">load_bitwarden_vars</code> that I call at the very end of <code class="language-plaintext highlighter-rouge">config.fish</code> so something like this</p>

<pre><code class="language-fish">function load_bitwarden_vars
  set -gx GITHUB_CLIENT_ID $(rbw get github -f client_id)
  set -gx GITHUB_CLIENT_SECRET $(rbw get github -f client_secret)
  set -gx ZT_TOKEN $(rbw get zerotier -f token)
  set -gx ZT_NWID $(rbw get zerotier -f network_id)
end
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">rbw</code> tool has the advantage over <code class="language-plaintext highlighter-rouge">bw</code> that it is a lot faster retrieving data, milliseconds, not seconds. But the more calls you do to it during start up of fish shell the slower it gets for you to see the shell prompt whenever you open a window. This is unwieldly. I don‚Äôt have 4 vars, I have plenty more of them. After filling up my <code class="language-plaintext highlighter-rouge">load_bitwarden_vars.fish</code> file containing the function this took a very **unacceptable **long time.</p>

<p>I came up with the idea of putting each var directly as an alias or abbreviation of the tool it uses them. So, e.g: vault became either</p>

<pre><code class="language-fish"># option 1
abb --add vault "TOKEN=$(rbw get...) vault"
# option 2
alias vault "TOKEN=$(rbw get...) /run/current-system/sw/bin/vault"
</code></pre>

<p>Yet alias has the issue of needing the whole vault path (Nixos) otherwise it becomes an infinite loop and Fish doesn‚Äôt allow it. And both have the major issue of computing the values when Fish launches so very slow.</p>

<h1 id="the-solution">The solution</h1>

<p>One call, just one. It doesn‚Äôt matter how big is the item, with just one call it still takes less than a second. So I created an item called <code class="language-plaintext highlighter-rouge">tokens</code> in Bitwarden, I made it as a note, but it really doesn‚Äôt matter if you store it as a login, identity or anything else because <code class="language-plaintext highlighter-rouge">rbw</code> doesn‚Äôt care of what it is when it retrieves it with <code class="language-plaintext highlighter-rouge">rbw get tokens</code> all that matters is the custom fields I created.</p>

<p>For each one of the variables I want to retrieve I created a hidden text field, with the exact name of the variable. For conveniency I used Bitwarden-desktop for this but you could easily use the CLI tool or <code class="language-plaintext highlighter-rouge">rbw</code> itself to do so. I just had to do too much copy and paste from different places so prefered the visual GUI.
<img src="/assets/images/2025-10-image-2.png" alt="Image" />
The elegance of this approach is that I get to name all vars directly on Bitwarden as custom-fields, no sign of them in my fish config files.</p>

<p>So now to get Fish to load them type <code class="language-plaintext highlighter-rouge">funced load_bitwarden_vars</code> and add this to it</p>

<pre><code class="language-fish">function load_bitwarden_vars
  set TOKENS $(rbw get tokens --raw)
  for pair in (printf "%s" "$TOKENS" | jq -r '.fields[] | "\(.name)=\(.value)"')
    set -l parts (string split -m1 = $pair)
    set -gx $parts[1] $parts[2]
  end
end
</code></pre>

<p>Then <code class="language-plaintext highlighter-rouge">funcsave load_bitwarden_vars</code> to store it in <code class="language-plaintext highlighter-rouge">$HOME/.config/fish/functions/load_bitwarden_vars.fish</code> and then add at the end of <code class="language-plaintext highlighter-rouge">$HOME/.config/fish/config.fish</code> the function name <code class="language-plaintext highlighter-rouge">load_bitwarden_vars</code> to run it after everything else of your config has loaded. In my case being at the end was quite important as I have modifiers for <code class="language-plaintext highlighter-rouge">PATH</code> in this file.</p>

<p>Now to test it fully lock your vault with <code class="language-plaintext highlighter-rouge">rbw lock</code> and close your terminal window. Open a newone and you should see üëá
<img src="/assets/images/2025-10-image-3.png" alt="Image" />
Once you log in, close the shell and open it again. This time it doesn‚Äôt ask for anything, you‚Äôll notice a very small lag but one you can <strong>comfortably</strong> live with. In fact try to open multiple terminal windows.</p>

<p>You‚Äôve tested both cases, being logged and locked. As you see it works.</p>

<p>**Problem solved! **ü•≥</p>

<h1 id="how-it-works">How it works</h1>

<p>It‚Äôs pretty simple actually, it uses the speed of <code class="language-plaintext highlighter-rouge">rbw</code> for any given item, combined with JQ to set the variables without making them universal so they don‚Äôt get written to disk.</p>

<ol>
  <li>We take the whole output as json of the item tokens from Bitwarden and assign it to the local variable TOKENS</li>
  <li>With JQ we extract from the fields array on TOKENS each one of the pairs of name and value  custom fields we created. Format them as lines name=value</li>
  <li>With a for loop we iterate over each one of those lines and assign them to pair</li>
  <li>The inner content of the loop asigns each part of part to the corresponding local variables name and value.</li>
  <li>The final line inside the loop assigns the globally exported variable. So that shell window and any subshells get the values.</li>
</ol>

<p>I‚Äôm sure it can be improved and if you come up with ideas feel free to provide me some feedback. I‚Äôm not entirely sure of the difference between the types of variables. I mean universal, local and function environment variables are pretty self-explanatory but exported and global are not that clear. The manual says exported makes them available to child processes, but how‚Äôs that different from global? Feel free to share some light to me about this in Mastodon.</p>

<h1 id="useful-links">Useful links</h1>

<ul>
  <li>Fish shell scope in the Fish manual, very important to understand how set -U works.</li>
  <li>RBW repo page in Github.</li>
</ul>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="security" /><category term="tools" /><category term="Bitwarden" /><category term="NixOS" /><summary type="html"><![CDATA[Solving the major issue of Bitwarden being incredibly slow to load environment variables by combining rbw, jq and fish shell]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1614064641938.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1614064641938.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Particularidades del mercado inmobiliario de A Coru√±a</title><link href="https://blog.maikel.dev/2025/10/21/particularidades-del-mercado-inmobiliario-de-a-coruna.html" rel="alternate" type="text/html" title="Particularidades del mercado inmobiliario de A Coru√±a" /><published>2025-10-21T00:00:00+02:00</published><updated>2025-10-21T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/10/21/particularidades-del-mercado-inmobiliario-de-a-coruna</id><content type="html" xml:base="https://blog.maikel.dev/2025/10/21/particularidades-del-mercado-inmobiliario-de-a-coruna.html"><![CDATA[<h3 id="1modelo-urbano-e-hist√≥rico">1.<strong>Modelo urbano e hist√≥rico</strong></h3>

<ul>
  <li>Desde los a√±os 80, A Coru√±a presenta una divisi√≥n socioespacial marcada:Centro hist√≥rico y Ensanche ‚Üí clases medias-altas y procesos de rehabilitaci√≥n.</li>
  <li>Barrios perif√©ricos o sat√©lites (Novo Mesoiro, Matogrande, Someso, Los Rosales, Ventorrillo, Adormideras) ‚Üí creados en los 90-2000 bajo el mandato de Francisco V√°zquez, con carencias de servicios, movilidad y cohesi√≥n urbana.</li>
</ul>
<p>&lt;/li&gt;&lt;li&gt;La expansi√≥n perif√©rica se hizo a costa de <strong>abandonar el centro</strong>, lo que facilit√≥ m√°s tarde la <strong>gentrificaci√≥n</strong> y el <strong>encarecimiento de la vivienda rehabilitada</strong>.&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;</p>
<h3 id="2estructura-y-din√°mica-del-mercado">2.<strong>Estructura y din√°mica del mercado</strong></h3>

<ul>
  <li>Oferta muy reducida de alquiler y exceso de vivienda vac√≠a o en mal estado.</li>
  <li>Se mantiene una preferencia cultural por la propiedad, pero la compra se volvi√≥ inalcanzable para gran parte de la poblaci√≥n desde los 2000.</li>
  <li>Los precios del alquiler subieron de manera constante entre 2014 y 2022, llegando a ser de los m√°s altos de Galicia, especialmente en barrios c√©ntricos como Papagayo o Monte Alto.</li>
</ul>
<hr />

<h3 id="3gentrificaci√≥n-urbana-y-comercial">3.<strong>Gentrificaci√≥n urbana y comercial</strong></h3>

<ul>
  <li>A Coru√±a ha vivido varias fases de gentrificaci√≥n:Fase 1 (2000‚Äì2008): rehabilitaci√≥n en Ciudad Vieja y Paseo del Parrote; transformaci√≥n del mercado de la Plaza de Lugo con la entrada de marcas de lujo e Inditex; encarecimiento del centro.</li>
  <li>Fase 2 (2008‚Äì2015): crisis del ladrillo ‚Üí precarizaci√≥n, pero tambi√©n consolidaci√≥n de la ‚Äúciudad creativa‚Äù, con llegada de poblaci√≥n joven con mayor renta.</li>
  <li>Fase 3 (2015‚Äìactualidad): expansi√≥n de la gentrificaci√≥n hacia Monte Alto, San Agust√≠n y Curros Enr√≠quez, ligada a rehabilitaci√≥n y turismo urbano.</li>
</ul>
<p>&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;</p>
<h3 id="4el-efecto-inditex">4.<strong>El ‚Äúefecto Inditex‚Äù</strong></h3>

<ul>
  <li>Inditex no domina toda la econom√≠a urbana, pero tiene efectos indirectos claros:Simbolismo y atracci√≥n de talento: la empresa genera una imagen de prosperidad que influye en la percepci√≥n de la ciudad.</li>
  <li>Cambio en la demanda residencial: los trabajadores de Inditex son considerados inquilinos ‚Äúideales‚Äù, percibidos como solventes y estables, lo que margina al precariado local.</li>
  <li>Contribuci√≥n indirecta a la gentrificaci√≥n: zonas c√©ntricas se adaptan al estilo de vida de esa ‚Äúclase creativa‚Äù y a la econom√≠a del consumo cultural y tur√≠stico.</li>
  <li>La autora y los expertos advierten que A Coru√±a depende en exceso del ‚Äúmonocultivo Inditex‚Äù (hasta un 45% de la productividad local), lo que supone un riesgo futuro.</li>
</ul>
<p>&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;</p>
<h3 id="5problemas-estructurales">5.<strong>Problemas estructurales</strong></h3>

<ul>
  <li>Escasez de vivienda p√∫blica y pol√≠ticas de alquiler social.</li>
  <li>Desigualdad territorial: distritos como Monte Alto y Torre concentran precios m√°s altos; Los Mallos o Agra del Orz√°n muestran menor renta y envejecimiento poblacional.</li>
  <li>Dependencia del sector inmobiliario y de la plusval√≠a del suelo en los presupuestos municipales.</li>
  <li>Presi√≥n del turismo y auge de pisos tur√≠sticos, que agravan la exclusi√≥n residencial.</li>
</ul>
<hr />

<h3 id="-conclusi√≥n-general">üß≠ Conclusi√≥n general</h3>

<p>El mercado inmobiliario coru√±√©s combina tres tensiones:</p>

<ol>
  <li>Desequilibrio centro-periferia ‚Üí abandono del centro seguido de gentrificaci√≥n.</li>
  <li>Influencia de Inditex ‚Üí simb√≥lica y material, reconfigura qui√©n puede vivir y consumir en el centro.</li>
  <li>D√©bil intervenci√≥n p√∫blica ‚Üí pol√≠ticas de vivienda insuficientes para frenar exclusi√≥n o especulaci√≥n.</li>
</ol>

<p>En palabras de la tesis, A Coru√±a es hoy <strong>una ‚Äúciudad creativa gentrificada‚Äù</strong>, donde el acceso a la vivienda depende tanto de los ingresos como del tipo de empleo y de la identidad social del inquilino.</p>
<hr />

<h1 id="bibliograf√≠a">Bibliograf√≠a</h1>

<ul>
  <li>Maravillosa tesis doctoral de 400 y pico p√°ginas de Julia Nogueira Dominguez https://ruc.udc.es/entities/publication/8a8f26be-5d80-483e-8241-50f59c7aa920</li>
</ul>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="real-estate" /><category term="Spain" /><category term="Coru√±a" /><summary type="html"><![CDATA[Encontr√© una t√©sis de 400 y pico p√°ginas sobre la influencia de Inditext en el mercado inmobiliario de Coru√±a pero lo mas maravilloso de la tesis no es inditex sino como desgrana en 400 p√°ginas las particularidades de esta ciudad. Aqui un resumen.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1560253451.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1560253451.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Using HAProxy for Ngrok-style domain tunneling in Nixos with SSL self-renewal enabled</title><link href="https://blog.maikel.dev/2025/10/14/using-haproxy-for-ngrok-style-domain-tunneling-in-nixos-with-ssl-self-renewal-enabled.html" rel="alternate" type="text/html" title="Using HAProxy for Ngrok-style domain tunneling in Nixos with SSL self-renewal enabled" /><published>2025-10-14T00:00:00+02:00</published><updated>2025-10-14T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/10/14/using-haproxy-for-ngrok-style-domain-tunneling-in-nixos-with-ssl-self-renewal-enabled</id><content type="html" xml:base="https://blog.maikel.dev/2025/10/14/using-haproxy-for-ngrok-style-domain-tunneling-in-nixos-with-ssl-self-renewal-enabled.html"><![CDATA[<p>I love accessing computers from elsewhere yet hate Ngrok, Tailscale and Zrok with passion so I made a post not long ago about <a href="/pagekite-with-custom-domain-in-nixos-tunneling-without-ngrok-for-free/">how to self-host Pagekite</a> to be able to use your own domain names for this. The problem is how ugly it made my configuration.nix files and how I didn‚Äôt manage to write an auto-renewal script. Today I‚Äôve figured how using ACME. HAProxy seems to have the same issue of wanting a single file for all keys but I managed to bypass that one here.</p>

<h1 id="configurationnix">Configuration.nix</h1>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Assuming configuration.nix</span>
<span class="p">{</span>
  <span class="c"># Rest of your file</span>
  <span class="nv">imports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># Rest of your imports</span>
    <span class="sx">./haproxy-acme.nix</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="server-haproxy-acmenix">Server: haproxy-acme.nix</h1>

<p>Change <code class="language-plaintext highlighter-rouge">serverNames</code> for whatever list of servers you want to add, don‚Äôt forget to manually edit the <code class="language-plaintext highlighter-rouge">services.haproxy.config</code> configuration too for your added servernames without SSL, in my case is my zerotier one, accessible on my zerotier network.</p>

<p>The <code class="language-plaintext highlighter-rouge">acme_email</code>variable should point to your var.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">config</span><span class="p">,</span> <span class="nv">pkgs</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<span class="kd">let</span>
  <span class="nv">acme_email</span> <span class="o">=</span> <span class="s2">"acme@maikel.dev"</span><span class="p">;</span>
  <span class="c"># Map domains to their backend host:port</span>
  <span class="nv">serverBackends</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"something_one.maikeladas.es"</span> <span class="o">=</span> <span class="s2">"127.0.0.1:4000"</span><span class="p">;</span> <span class="c"># Phoenix dev server.</span>
    <span class="s2">"something_else.maikeladas.es"</span> <span class="o">=</span> <span class="s2">"thinkpad.zerotier:8080"</span><span class="p">;</span> <span class="c">#Zerotier URL</span>
  <span class="p">};</span>
  <span class="nv">serverNames</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">attrNames</span> <span class="nv">serverBackends</span><span class="p">;</span>
  <span class="c"># ACLs</span>
  <span class="nv">aclLines</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">concatStringsSep</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">d</span><span class="p">:</span>
    <span class="kd">let</span> <span class="nv">aclName</span> <span class="o">=</span> <span class="s2">"host_</span><span class="si">${</span><span class="kr">builtins</span><span class="o">.</span><span class="nv">replaceStrings</span> <span class="p">[</span> <span class="s2">"."</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"_"</span> <span class="p">]</span> <span class="nv">d</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
    <span class="kn">in</span> <span class="s2">"  acl </span><span class="si">${</span><span class="nv">aclName</span><span class="si">}</span><span class="s2"> hdr(host) -i </span><span class="si">${</span><span class="nv">d</span><span class="si">}</span><span class="s2">"</span>
  <span class="p">)</span> <span class="nv">serverNames</span><span class="p">);</span>
  <span class="nv">redirectLines</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">concatStringsSep</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">d</span><span class="p">:</span>
    <span class="s2">"  http-request redirect scheme https code 301 if host_</span><span class="si">${</span><span class="kr">builtins</span><span class="o">.</span><span class="nv">replaceStrings</span> <span class="p">[</span> <span class="s2">"."</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"_"</span> <span class="p">]</span> <span class="nv">d</span><span class="si">}</span><span class="s2">"</span>
  <span class="p">)</span> <span class="nv">serverNames</span><span class="p">);</span>
  <span class="c"># use_backend lines</span>
  <span class="nv">backendLines</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">concatStringsSep</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">d</span><span class="p">:</span>
    <span class="kd">let</span>
      <span class="nv">aclName</span> <span class="o">=</span> <span class="s2">"host_</span><span class="si">${</span><span class="kr">builtins</span><span class="o">.</span><span class="nv">replaceStrings</span> <span class="p">[</span> <span class="s2">"."</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"_"</span> <span class="p">]</span> <span class="nv">d</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
      <span class="nv">backendName</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">replaceStrings</span> <span class="p">[</span> <span class="s2">"."</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"_"</span> <span class="p">]</span> <span class="nv">d</span><span class="p">;</span>
    <span class="kn">in</span> <span class="s2">"  use_backend </span><span class="si">${</span><span class="nv">backendName</span><span class="si">}</span><span class="s2">_app if </span><span class="si">${</span><span class="nv">aclName</span><span class="si">}</span><span class="s2">"</span>
  <span class="p">)</span> <span class="nv">serverNames</span><span class="p">);</span>
  <span class="c"># crt files</span>
  <span class="nv">crtFiles</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">concatStringsSep</span> <span class="s2">" "</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">d</span><span class="p">:</span>
    <span class="s2">"crt /var/lib/haproxy/certs/</span><span class="si">${</span><span class="nv">d</span><span class="si">}</span><span class="s2">.pem"</span>
  <span class="p">)</span> <span class="nv">serverNames</span><span class="p">);</span>
  <span class="c"># backend definitions</span>
  <span class="nv">backendDefs</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">concatStringsSep</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">d</span><span class="p">:</span>
    <span class="kd">let</span>
      <span class="nv">backendName</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">replaceStrings</span> <span class="p">[</span> <span class="s2">"."</span> <span class="p">]</span> <span class="p">[</span> <span class="s2">"_"</span> <span class="p">]</span> <span class="nv">d</span><span class="p">;</span>
      <span class="nv">backendAddr</span> <span class="o">=</span> <span class="nv">serverBackends</span><span class="o">.</span><span class="p">${</span><span class="nv">d</span><span class="p">};</span>
      <span class="nv">indent</span> <span class="o">=</span> <span class="s2">"    "</span><span class="p">;</span> <span class="c"># 1 tab = 4 spaces</span>
    <span class="kn">in</span> <span class="s2">''</span><span class="err">
</span><span class="s2">      backend </span><span class="si">${</span><span class="nv">backendName</span><span class="si">}</span><span class="s2">_app</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        server </span><span class="si">${</span><span class="nv">backendName</span><span class="si">}</span><span class="s2">_1 </span><span class="si">${</span><span class="nv">backendAddr</span><span class="si">}</span><span class="s2"> check inter 2s fall 3 rise 2</span><span class="err">
</span><span class="s2">        errorfiles customerrors</span><span class="err">
</span><span class="s2">    ''</span>
  <span class="p">)</span> <span class="nv">serverNames</span><span class="p">);</span>
<span class="kn">in</span> <span class="p">{</span>
  <span class="c"># SSL certificates for HAProxy</span>
  <span class="nv">security</span><span class="o">.</span><span class="nv">acme</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">acceptTerms</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">defaults</span><span class="o">.</span><span class="nv">email</span> <span class="o">=</span> <span class="nv">acme_email</span><span class="p">;</span>
    <span class="nv">certs</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">listToAttrs</span> <span class="p">(</span><span class="kr">map</span> <span class="p">(</span><span class="nv">domain</span><span class="p">:</span> <span class="p">{</span>
      <span class="nv">name</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">;</span>
      <span class="nv">value</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">webroot</span> <span class="o">=</span> <span class="s2">"/var/lib/acme/acme-challenge"</span><span class="p">;</span>
        <span class="nv">group</span> <span class="o">=</span> <span class="s2">"haproxy"</span><span class="p">;</span>
        <span class="nv">postRun</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">          mkdir -p /var/lib/haproxy/certs</span><span class="err">
</span><span class="s2">          cat /var/lib/acme/</span><span class="si">${</span><span class="nv">domain</span><span class="si">}</span><span class="s2">/fullchain.pem \</span><span class="err">
</span><span class="s2">            /var/lib/acme/</span><span class="si">${</span><span class="nv">domain</span><span class="si">}</span><span class="s2">/key.pem \</span><span class="err">
</span><span class="s2">            &gt; /var/lib/haproxy/certs/</span><span class="si">${</span><span class="nv">domain</span><span class="si">}</span><span class="s2">.pem</span><span class="err">
</span><span class="s2">          chown root:haproxy /var/lib/haproxy/certs/</span><span class="si">${</span><span class="nv">domain</span><span class="si">}</span><span class="s2">.pem</span><span class="err">
</span><span class="s2">          chmod 0640 /var/lib/haproxy/certs/</span><span class="si">${</span><span class="nv">domain</span><span class="si">}</span><span class="s2">.pem</span><span class="err">
</span><span class="s2">        ''</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">})</span> <span class="nv">serverNames</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="c"># HAProxy service</span>
  <span class="nv">services</span><span class="o">.</span><span class="nv">haproxy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">config</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">      global</span><span class="err">
</span><span class="s2">        log stdout format raw local0</span><span class="err">
</span><span class="s2">        maxconn 2000</span><span class="err">

</span><span class="s2">      defaults</span><span class="err">
</span><span class="s2">        log global</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        option httplog</span><span class="err">
</span><span class="s2">        option dontlognull</span><span class="err">
</span><span class="s2">        option forwardfor except 127.0.0.1</span><span class="err">
</span><span class="s2">        timeout connect 5s</span><span class="err">
</span><span class="s2">        timeout client 30s</span><span class="err">
</span><span class="s2">        timeout server 30s</span><span class="err">
</span><span class="s2">        retries 3</span><span class="err">

</span><span class="s2">      frontend http_in</span><span class="err">
</span><span class="s2">        bind *:80</span><span class="err">
</span><span class="s2">        acl acme_challenge path_beg /.well-known/acme-challenge/</span><span class="err">
</span><span class="s2">        use_backend acme_backend if acme_challenge</span><span class="err">
</span><span class="s2">        acl host_zt hdr(host) -i stephen.zerotier</span><span class="err">
</span><span class="s2">        </span><span class="si">${</span><span class="nv">aclLines</span><span class="si">}</span><span class="err">
</span><span class="s2">        use_backend something_one_maikeladas_es_app if host_zt</span><span class="err">
</span><span class="s2">        </span><span class="si">${</span><span class="nv">redirectLines</span><span class="si">}</span><span class="err">
</span><span class="s2">        default_backend not_found</span><span class="err">

</span><span class="s2">      frontend https_in</span><span class="err">
</span><span class="s2">        bind *:443 ssl </span><span class="si">${</span><span class="nv">crtFiles</span><span class="si">}</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        acl acme_challenge path_beg /.well-known/acme-challenge/</span><span class="err">
</span><span class="s2">        </span><span class="si">${</span><span class="nv">aclLines</span><span class="si">}</span><span class="err">
</span><span class="s2">        use_backend acme_backend if acme_challenge</span><span class="err">
</span><span class="s2">        </span><span class="si">${</span><span class="nv">backendLines</span><span class="si">}</span><span class="err">
</span><span class="s2">        default_backend not_found</span><span class="err">

</span><span class="s2">      backend acme_backend</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        server local_acme 127.0.0.1:8081</span><span class="err">

</span><span class="s2">      </span><span class="si">${</span><span class="nv">backendDefs</span><span class="si">}</span><span class="err">

</span><span class="s2">      http-errors customerrors</span><span class="err">
</span><span class="s2">        errorfile 503 /etc/haproxy/errorfiles/503.http</span><span class="err">

</span><span class="s2">      backend not_found</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        errorfiles customerrors</span><span class="err">
</span><span class="s2">    ''</span><span class="p">;</span>
    <span class="nv">user</span> <span class="o">=</span> <span class="s2">"haproxy"</span><span class="p">;</span>
    <span class="nv">group</span> <span class="o">=</span> <span class="s2">"haproxy"</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nv">environment</span><span class="o">.</span><span class="nv">etc</span><span class="o">.</span><span class="s2">"haproxy/errorfiles/503.http"</span><span class="o">.</span><span class="nv">text</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    HTTP/1.1 503 Service Unavailable</span><span class="err">
</span><span class="s2">    Cache-Control: no-cache</span><span class="err">
</span><span class="s2">    Connection: close</span><span class="err">
</span><span class="s2">    Content-Type: text/html</span><span class="err">
</span><span class="s2">    </span><span class="si">${</span><span class="kr">builtins</span><span class="o">.</span><span class="nv">readFile</span> <span class="sx">./haproxy-error-503.html</span><span class="si">}</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>

  <span class="c"># Local HTTP server to serve ACME challenges</span>
  <span class="nv">systemd</span><span class="o">.</span><span class="nv">services</span><span class="o">.</span><span class="nv">acme-challenge-server</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">description</span> <span class="o">=</span> <span class="s2">"Serve Let's Encrypt challenges for HAProxy"</span><span class="p">;</span>
    <span class="nv">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"multi-user.target"</span> <span class="p">];</span>
    <span class="nv">serviceConfig</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">ExecStart</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pkgs</span><span class="o">.</span><span class="nv">python3</span><span class="si">}</span><span class="s2">/bin/python3 -m http.server 8081 --directory /var/lib/acme/acme-challenge"</span><span class="p">;</span>
      <span class="nv">Restart</span> <span class="o">=</span> <span class="s2">"always"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="your-laptop-or-other-pc-configuration-to-be-accessible">Your laptop or other PC configuration to be accessible</h1>

<p>Assuming you use Zerotier (is free) and have it in the same network as the server (I do) and you know the IP or domain name if you have it in /etc/hosts (I do but I prefer to use IPs). Notice how I‚Äôve limited the listening interfaces to that one of Zerotier only.</p>

<p>Of course import this file in your configuration for that machine. I call it <code class="language-plaintext highlighter-rouge">haproxy-redirect.nix</code> to make it clear what the nix contains.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">config</span><span class="p">,</span> <span class="nv">pkgs</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<span class="p">{</span>
  <span class="c"># HAProxy service</span>
  <span class="nv">services</span><span class="o">.</span><span class="nv">haproxy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">config</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">      global</span><span class="err">
</span><span class="s2">        log stdout format raw local0</span><span class="err">
</span><span class="s2">        maxconn 2000</span><span class="err">

</span><span class="s2">      defaults</span><span class="err">
</span><span class="s2">        log global</span><span class="err">
</span><span class="s2">        mode http</span><span class="err">
</span><span class="s2">        option httplog</span><span class="err">
</span><span class="s2">        option dontlognull</span><span class="err">
</span><span class="s2">        option forwardfor except 127.0.0.1</span><span class="err">
</span><span class="s2">        timeout connect 5s</span><span class="err">
</span><span class="s2">        timeout client 30s</span><span class="err">
</span><span class="s2">        timeout server 30s</span><span class="err">
</span><span class="s2">        retries 3</span><span class="err">

</span><span class="s2">      frontend local_http</span><span class="err">
</span><span class="s2">        bind thinkpad.zerotier:8080</span><span class="err">
</span><span class="s2">        default_backend phoenix_app</span><span class="err">

</span><span class="s2">      backend phoenix_app</span><span class="err">
</span><span class="s2">        server phoenix_1 127.0.0.1:4000 check inter 2s fall 3 rise 2</span><span class="err">
</span><span class="s2">        errorfile 503 /etc/haproxy/errorfiles/503.http</span><span class="err">
</span><span class="s2">    ''</span><span class="p">;</span>
    <span class="nv">user</span> <span class="o">=</span> <span class="s2">"haproxy"</span><span class="p">;</span>
    <span class="nv">group</span> <span class="o">=</span> <span class="s2">"haproxy"</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nv">environment</span><span class="o">.</span><span class="nv">etc</span><span class="o">.</span><span class="s2">"haproxy/errorfiles/503.http"</span><span class="o">.</span><span class="nv">text</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    HTTP/1.1 503 Service Unavailable</span><span class="err">
</span><span class="s2">    Cache-Control: no-cache</span><span class="err">
</span><span class="s2">    Connection: close</span><span class="err">
</span><span class="s2">    Content-Type: text/html</span><span class="err">
</span><span class="s2">    </span><span class="si">${</span><span class="kr">builtins</span><span class="o">.</span><span class="nv">readFile</span> <span class="sx">./haproxy-error-503.html</span><span class="si">}</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="the-default-503-error-file">The default 503 error file</h2>

<p><img src="/assets/images/2025-10-image-1.png" alt="Image" /></p>

<p>All errors I got when I turned off any of them servers were of type 503 so that‚Äôs the error I customised. The files is <code class="language-plaintext highlighter-rouge">haproxy-error-503.html</code> and should be in the same folder as the nix configuration. The content is this</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Service Unavailable<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;style&gt;</span>
      <span class="nt">body</span> <span class="p">{</span>
        <span class="nl">font-family</span><span class="p">:</span> <span class="o">-</span><span class="n">apple-system</span><span class="p">,</span> <span class="n">BlinkMacSystemFont</span><span class="p">,</span> <span class="s1">"Segoe UI"</span><span class="p">,</span> <span class="n">Roboto</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
        <span class="nl">background</span><span class="p">:</span> <span class="nx">#fafafa</span><span class="p">;</span>
        <span class="nl">color</span><span class="p">:</span> <span class="nx">#333</span><span class="p">;</span>
        <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="nl">display</span><span class="p">:</span> <span class="nb">flex</span><span class="p">;</span>
        <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="nl">height</span><span class="p">:</span> <span class="m">100vh</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nt">main</span> <span class="p">{</span>
        <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="nl">padding</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
        <span class="nl">background</span><span class="p">:</span> <span class="nx">white</span><span class="p">;</span>
        <span class="nl">border-radius</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
        <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">4px</span> <span class="m">12px</span> <span class="nf">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.08</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nt">h1</span> <span class="p">{</span>
        <span class="nl">font-size</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
        <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">0.5rem</span><span class="p">;</span>
        <span class="nl">color</span><span class="p">:</span> <span class="nx">#c0392b</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nt">p</span> <span class="p">{</span>
        <span class="nl">font-size</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
        <span class="nl">color</span><span class="p">:</span> <span class="nx">#666</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;main&gt;</span>
      <span class="nt">&lt;h1&gt;</span>503 ‚Äì Service Unavailable<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;p&gt;</span>Our server is taking a quick break. Please try again in a moment.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/main&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h1 id="advantages-over-the-pagekite-way">Advantages over the Pagekite way</h1>

<ol>
  <li>HAProxy is a lot more robust.</li>
  <li>Since you‚Äôre using already a machine as server and Zerotier for LAN-like communication, this harness precisely all that to make the config a lot simpler.</li>
  <li>SSL renewal bult-in.</li>
  <li>You can just stop the services whenever, the 503 custom-error page will be shown. No need to remember to ‚Äúsysctl stop whatever‚Äù</li>
  <li>Custom error page.</li>
</ol>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="NixOS" /><category term="DevOps" /><category term="networking" /><category term="tunneling" /><category term="SSL" /><summary type="html"><![CDATA[Another way to do the same tunneling without Ngrok or any paid service, but this time with autorenewal of the SSL and in a more robust and simple manner.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1637481687365.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1637481687365.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Pagekite with Custom Domain in Nixos, tunneling without Ngrok for free</title><link href="https://blog.maikel.dev/2025/10/09/pagekite-with-custom-domain-in-nixos-tunneling-without-ngrok-for-free.html" rel="alternate" type="text/html" title="Pagekite with Custom Domain in Nixos, tunneling without Ngrok for free" /><published>2025-10-09T00:00:00+02:00</published><updated>2025-10-09T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/10/09/pagekite-with-custom-domain-in-nixos-tunneling-without-ngrok-for-free</id><content type="html" xml:base="https://blog.maikel.dev/2025/10/09/pagekite-with-custom-domain-in-nixos-tunneling-without-ngrok-for-free.html"><![CDATA[<p>There are instructions all over on how to configure Pagekite on Ubuntu but none on NixOS there‚Äôs not even a derivation of it so I made one. I‚Äôm tired of Zrok, Ngrok, Tailscale and all of their offerings that are either closed-source or impossibly hard to install or maintain. Let alone **to use a custom domain **you‚Äôll have to pay north of 20 USD per month.</p>

<p>I just want to be able to use my own domains, that‚Äôs all. I don‚Äôt need any of the other fancy stuff so even though Pagekite is a lot cheaper than all of them 3, to use custom domains **with **SSL is not so much. So I decided to self-host the frontend. Btw, whoever decided to call the server ‚Äúfrontend‚Äù and the client ‚Äúbackend‚Äù deserves to be hanged upside down in a bucket filled with piranhas.</p>

<h2 id="getting-ssl">Getting SSL</h2>

<p>Think that here <code class="language-plaintext highlighter-rouge">DOMAIN</code> is going to be the parent domain. I could make it be directly maikeladas.es but I have other stuff there and using a wildcard would force me to get rid of subdomains so I rather use a subdomain for specific temporary stuff, in this case <code class="language-plaintext highlighter-rouge">dev.maikeladas.es</code>. I could have used <code class="language-plaintext highlighter-rouge">maikel.dev</code>but the restrictions of dev domains that you cannot use port 80. They force you to use 443 and SSL. I want flexibility.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nv">$HOME</span>/certs
<span class="nb">set </span>DOMAIN dev.maikeladas.es
nix-shell <span class="nt">-p</span> certbot
certbot certonly <span class="nt">--manual</span> <span class="se">\</span>
  <span class="nt">--work-dir</span><span class="o">=</span><span class="nv">$HOME</span>/certs <span class="nt">--logs-dir</span><span class="o">=</span>/tmp/ <span class="nt">--config-dir</span><span class="o">=</span><span class="nv">$HOME</span>/certs <span class="se">\</span>
  <span class="nt">--preferred-challenges</span><span class="o">=</span>dns <span class="se">\</span>
  <span class="nt">--email</span> avalid@email.whatever <span class="se">\</span>
  <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory <span class="se">\</span>
  <span class="nt">--agree-tos</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s2">"*.</span><span class="nv">$DOMAIN</span><span class="s2">"</span>
<span class="nb">exit
sudo cat</span> <span class="se">\</span>
  <span class="nv">$HOME</span>/certs/live/<span class="nv">$DOMAIN</span>/fullchain.pem <span class="se">\</span>
  <span class="nv">$HOME</span>/certs/live/<span class="nv">$DOMAIN</span>/privkey.pem <span class="se">\</span>
  | <span class="nb">sudo tee</span> <span class="nv">$HOME</span>/certs/keycert.pem <span class="o">&gt;</span> /dev/null
</code></pre></div></div>

<p>Now you have the keycert.pem file that Pagekite requires to provide domains over HTTPS. The certificate will require renewal every 6 months. It can be automated but that‚Äôs for another day.</p>

<h2 id="do-your-dns-changes">Do your DNS changes</h2>

<p>Go to your DNS provider. For the domain create a <code class="language-plaintext highlighter-rouge">*.dev.YOURDOMAIN.COM</code> record of A type pointing to the IP and one of the parent subdomain pointing to the same IP. So also <code class="language-plaintext highlighter-rouge">dev.YOURDOMAIN.COM</code> again of A type.</p>

<h2 id="nixos-changes-to-get-pagekite">NixOS Changes to get Pagekite</h2>

<p>Assuming you use configuration.nix or somefile.nix that is not a flake.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">config</span><span class="p">,</span> <span class="nv">lib</span><span class="p">,</span> <span class="nv">pkgs</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<span class="kd">let</span>
  <span class="nv">kitesecret</span> <span class="o">=</span> <span class="s2">"YOUR_KITE_PASS"</span><span class="p">;</span>
  <span class="nv">pagekite</span> <span class="o">=</span> <span class="kr">import</span> <span class="sx">./pagekite-package.nix</span> <span class="p">{</span> <span class="kn">inherit</span> <span class="nv">pkgs</span><span class="p">;</span> <span class="p">};</span>
<span class="kn">in</span> <span class="p">{</span>
  <span class="c"># The rest of your config</span>
  <span class="c"># To install the derivation while keeping it around to pass it</span>
  <span class="nv">environment</span><span class="o">.</span><span class="nv">systemPackages</span> <span class="o">=</span> <span class="nv">lib</span><span class="o">.</span><span class="nv">mkAfter</span> <span class="p">[</span> <span class="nv">pagekite</span> <span class="p">];</span>
  <span class="nv">imports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># ...your other imports</span>
    <span class="c"># Import as functions, passing pagekite and kitesecret explicitly</span>
    <span class="c"># If this machine is the client</span>
    <span class="p">(</span><span class="kr">import</span> <span class="sx">./pagekite-client.nix</span> <span class="p">{</span>
      <span class="kn">inherit</span> <span class="nv">config</span> <span class="nv">pkgs</span> <span class="nv">lib</span> <span class="nv">pagekite</span> <span class="nv">kitesecret</span><span class="p">;</span>
      <span class="nv">frontendHost</span> <span class="o">=</span> <span class="s2">"dev.maikeladas.es"</span><span class="p">;</span>
      <span class="nv">frontendPort</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
      <span class="nv">backendHost</span> <span class="o">=</span> <span class="s2">"stephen.dev.maikeladas.es"</span><span class="p">;</span>
      <span class="nv">backendLocalPort</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="c"># If this machine is the server</span>
    <span class="p">(</span><span class="kr">import</span> <span class="sx">./pagekite-server.nix</span> <span class="p">{</span>
      <span class="kn">inherit</span> <span class="nv">config</span> <span class="nv">pkgs</span> <span class="nv">lib</span> <span class="nv">pagekite</span> <span class="nv">kitesecret</span><span class="p">;</span>
      <span class="nv">kitename</span> <span class="o">=</span> <span class="s2">"*.dev.maikeladas.es"</span><span class="p">;</span>
      <span class="nv">ports</span> <span class="o">=</span> <span class="s2">"80,443"</span><span class="p">;</span>
      <span class="nv">protos</span> <span class="o">=</span> <span class="s2">"http,https"</span><span class="p">;</span>
      <span class="nv">domainHttp</span> <span class="o">=</span> <span class="s2">"*.dev.maikeladas.es"</span><span class="p">;</span>
      <span class="nv">domainHttps</span> <span class="o">=</span> <span class="s2">"*.dev.maikeladas.es"</span><span class="p">;</span>
      <span class="nv">tlsEndpoint</span> <span class="o">=</span> <span class="s2">"*.dev.maikeladas.es:/home/maikel/certs/keycert.pem"</span><span class="p">;</span>
    <span class="p">})</span>
  <span class="p">];</span>
  <span class="c"># The rest of your /etc/nixos/configuration.nix file</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="then-the-pagekite-packagenix">Then the pagekite-package.nix</h2>

<p>This is all you need to intsall pagekite.py</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">pkgs</span> <span class="p">}:</span>
<span class="nv">pkgs</span><span class="o">.</span><span class="nv">stdenv</span><span class="o">.</span><span class="nv">mkDerivation</span> <span class="kr">rec</span> <span class="p">{</span>
  <span class="nv">pname</span> <span class="o">=</span> <span class="s2">"pagekite"</span><span class="p">;</span>
  <span class="nv">version</span> <span class="o">=</span> <span class="s2">"1.0"</span><span class="p">;</span>
  <span class="nv">src</span> <span class="o">=</span> <span class="nv">pkgs</span><span class="o">.</span><span class="nv">fetchurl</span> <span class="p">{</span>
    <span class="nv">url</span> <span class="o">=</span> <span class="s2">"https://pagekite.net/pk/pagekite.py"</span><span class="p">;</span>
    <span class="nv">sha256</span> <span class="o">=</span> <span class="s2">"1nqa4nkhjq2shc7zpxn22pxfqpsl6xf06mfxlwa72c5p72zf7x94"</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nv">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[</span> <span class="nv">pkgs</span><span class="o">.</span><span class="nv">makeWrapper</span> <span class="p">];</span>
  <span class="nv">unpackPhase</span> <span class="o">=</span> <span class="s2">":"</span><span class="p">;</span>
  <span class="nv">installPhase</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    mkdir -p $out/bin</span><span class="err">
</span><span class="s2">    sed "1 s|^.*$|#!</span><span class="si">${</span><span class="nv">pkgs</span><span class="o">.</span><span class="nv">python3</span><span class="si">}</span><span class="s2">/bin/python3|" $src &gt; $out/bin/pagekite</span><span class="err">
</span><span class="s2">    chmod +x $out/bin/pagekite</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="then-the-pagekite-clientnix">Then the pagekite-client.nix</h2>

<p>This is the one to use a client.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">config</span><span class="p">,</span> <span class="nv">pkgs</span><span class="p">,</span> <span class="nv">lib</span><span class="p">,</span> <span class="nv">kitesecret</span><span class="p">,</span> <span class="nv">pagekite</span><span class="p">,</span> <span class="nv">frontendHost</span><span class="p">,</span> <span class="nv">frontendPort</span><span class="p">,</span> <span class="nv">backendHost</span><span class="p">,</span> <span class="nv">backendLocalPort</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<span class="kd">let</span>
  <span class="c"># Construct addresses</span>
  <span class="nv">frontend</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">frontendHost</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="kr">toString</span> <span class="nv">frontendPort</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
  <span class="nv">backend</span> <span class="o">=</span> <span class="s2">"http:</span><span class="si">${</span><span class="nv">backendHost</span><span class="si">}</span><span class="s2">:localhost:</span><span class="si">${</span><span class="kr">toString</span> <span class="nv">backendLocalPort</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
<span class="kn">in</span> <span class="p">{</span>
  <span class="c"># PageKite client configuration file</span>
  <span class="nv">environment</span><span class="o">.</span><span class="nv">etc</span><span class="o">.</span><span class="s2">"pagekite.d/</span><span class="si">${</span><span class="nv">backendHost</span><span class="si">}</span><span class="s2">.conf"</span><span class="o">.</span><span class="nv">text</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    frontend = </span><span class="si">${</span><span class="nv">frontend</span><span class="si">}</span><span class="err">
</span><span class="s2">    service_on = </span><span class="si">${</span><span class="nv">backend</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">kitesecret</span><span class="si">}</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>

  <span class="c"># Systemd service</span>
  <span class="nv">systemd</span><span class="o">.</span><span class="nv">services</span><span class="o">.</span><span class="s2">"pagekite-client-</span><span class="si">${</span><span class="nv">backendHost</span><span class="si">}</span><span class="s2">"</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">description</span> <span class="o">=</span> <span class="s2">"PageKite Client Tunnel Service for </span><span class="si">${</span><span class="nv">backendHost</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
    <span class="nv">after</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"network.target"</span> <span class="p">];</span>
    <span class="nv">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"multi-user.target"</span> <span class="p">];</span>
    <span class="nv">serviceConfig</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"simple"</span><span class="p">;</span>
      <span class="nv">ExecStart</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pagekite</span><span class="si">}</span><span class="s2">/bin/pagekite --optfile /etc/pagekite.d/</span><span class="si">${</span><span class="nv">backendHost</span><span class="si">}</span><span class="s2">.conf"</span><span class="p">;</span>
      <span class="nv">Restart</span> <span class="o">=</span> <span class="s2">"always"</span><span class="p">;</span>
      <span class="nv">RestartSec</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
      <span class="nv">User</span> <span class="o">=</span> <span class="s2">"root"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="then-the-pagekite-servernix">Then the pagekite-server.nix</h2>

<p>This is the one to run a server. This machine needs to be one that responds when you ping <code class="language-plaintext highlighter-rouge">dev.YOURDOMAIN.COM</code> and <code class="language-plaintext highlighter-rouge">*.dev.YOURDOMAIN.COM</code> so you must have your DNS configured correctly.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">config</span><span class="p">,</span> <span class="nv">pkgs</span><span class="p">,</span> <span class="nv">lib</span><span class="p">,</span> <span class="nv">kitesecret</span><span class="p">,</span> <span class="nv">pagekite</span><span class="p">,</span> <span class="nv">kitename</span><span class="p">,</span> <span class="nv">ports</span><span class="p">,</span> <span class="nv">protos</span><span class="p">,</span> <span class="nv">domainHttp</span><span class="p">,</span> <span class="nv">domainHttps</span><span class="p">,</span> <span class="nv">tlsEndpoint</span><span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<span class="p">{</span>
  <span class="c"># PageKite server configuration file</span>
  <span class="nv">environment</span><span class="o">.</span><span class="nv">etc</span><span class="o">.</span><span class="s2">"pagekite.d/pk-server.conf"</span><span class="o">.</span><span class="nv">text</span> <span class="o">=</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    kitename = </span><span class="si">${</span><span class="nv">kitename</span><span class="si">}</span><span class="err">
</span><span class="s2">    kitesecret = </span><span class="si">${</span><span class="nv">kitesecret</span><span class="si">}</span><span class="err">
</span><span class="s2">    isfrontend</span><span class="err">
</span><span class="s2">    ports = </span><span class="si">${</span><span class="nv">ports</span><span class="si">}</span><span class="err">
</span><span class="s2">    protos = </span><span class="si">${</span><span class="nv">protos</span><span class="si">}</span><span class="err">
</span><span class="s2">    domain = http:</span><span class="si">${</span><span class="nv">domainHttp</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">kitesecret</span><span class="si">}</span><span class="err">
</span><span class="s2">    domain = https:</span><span class="si">${</span><span class="nv">domainHttps</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">kitesecret</span><span class="si">}</span><span class="err">
</span><span class="s2">    tls_endpoint = </span><span class="si">${</span><span class="nv">tlsEndpoint</span><span class="si">}</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>

  <span class="c"># Systemd service</span>
  <span class="nv">systemd</span><span class="o">.</span><span class="nv">services</span><span class="o">.</span><span class="nv">pagekite</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">description</span> <span class="o">=</span> <span class="s2">"PageKite Reverse Tunnel Service"</span><span class="p">;</span>
    <span class="nv">after</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"network.target"</span> <span class="p">];</span>
    <span class="nv">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"multi-user.target"</span> <span class="p">];</span>
    <span class="nv">serviceConfig</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"simple"</span><span class="p">;</span>
      <span class="nv">ExecStart</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pagekite</span><span class="si">}</span><span class="s2">/bin/pagekite --optfile /etc/pagekite.d/pk-server.conf"</span><span class="p">;</span>
      <span class="nv">Restart</span> <span class="o">=</span> <span class="s2">"always"</span><span class="p">;</span>
      <span class="nv">RestartSec</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
      <span class="nv">User</span> <span class="o">=</span> <span class="s2">"root"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="how-to-use-it">How to use it</h1>

<p>On whatever machine plays as server add the necessary files to run the server, and on the client for the client. Both cases need pagekite-package.nix though. Then just <code class="language-plaintext highlighter-rouge">nixos-rebuild switch</code> or whatever NixOS method you use to update your config.</p>

<p>I normally do a <code class="language-plaintext highlighter-rouge">sudo systemctl stop pagekite-client-DOMAIN</code> after running any client the first time so it‚Äôs only available when I need it.
<img src="/assets/images/2025-10-image.png" alt="Image" /></p>
<h2 id="caveats">Caveats</h2>

<ol>
  <li>I haven‚Äôt automated SSL renewal, it can be done, but I need to have a life. I might not be using this in six months.</li>
  <li>If you stop whatever is you‚Äôre serving or the server, the client hangs and does not auto-reconnect. So get ready to restart the client.</li>
  <li>You won‚Äôt have to pay ever again Zrok, Ngrok or Tailscale for using a custom domain. Oh, the suffering!</li>
</ol>

<!--kg-card-begin: html-->
<div><iframe src="https://giphy.com/embed/5WXqTFTgO9a7e" frameborder="0" allowfullscreen=""></iframe></div>
<!--kg-card-end: html-->
<p>If you liked this article consider tipping me on Ko-Fi üëá
<!--kg-card-begin: html-->
<script type="text/javascript" src="https://storage.ko-fi.com/cdn/widget/Widget_2.js"></script><script type="text/javascript">kofiwidget2.init('Support me on Ko-fi', '#72a4f2', 'H2H4GCC0N');kofiwidget2.draw();</script>
<!--kg-card-end: html--></p>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="NixOS" /><category term="DevOps" /><category term="networking" /><category term="tunneling" /><summary type="html"><![CDATA[I got tired of Ngrok, Zrok, Tailscale and all of these options that charge you absurds amounts of money for just letting you use your own domain names in a web tunnel to try APIs or development. So I made my own derivation in NixOS to run Pagekite.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1610098905401.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1610098905401.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Running FreeBSD from NixOS using Libvirtd from scratch</title><link href="https://blog.maikel.dev/2025/09/27/running-freebsd-from-nixos-using-libvirtd-from-scratch.html" rel="alternate" type="text/html" title="Running FreeBSD from NixOS using Libvirtd from scratch" /><published>2025-09-27T00:00:00+02:00</published><updated>2025-09-27T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/09/27/running-freebsd-from-nixos-using-libvirtd-from-scratch</id><content type="html" xml:base="https://blog.maikel.dev/2025/09/27/running-freebsd-from-nixos-using-libvirtd-from-scratch.html"><![CDATA[<p>I use <strong>FreeBSD</strong> for work because my clients deploy servers on it. At home, I have a PC with 32 GB of RAM and use <strong>NixOS</strong>, so I wanted to run FreeBSD locally for quick tests.</p>

<p>My first choice would normally be <strong>VirtualBox</strong>, but on NixOS it‚Äôs a pain: every system upgrade forces VirtualBox to be recompiled. Since I upgrade often, that became unmanageable.</p>

<p>People in the fediverse suggested <strong>libvirtd</strong>, so I gave it a try. It‚Äôs trickier at first, but once you learn a few commands it‚Äôs not bad at all‚Äîand in fact, it allows for a lot of automation.</p>

<details>
  <summary>Version History</summary>

  <p>This guide has evolved through several iterations:</p>

  <p><strong>v3.0 (Current)</strong></p>
  <ul>
    <li>Removed <code class="language-plaintext highlighter-rouge">add_vm_to_network</code> Fish-shell function (no longer necessary with NSS)</li>
    <li>Fixed <code class="language-plaintext highlighter-rouge">create_vm</code> Fish-shell function (no longer needs MACs)</li>
    <li>Simplified network edition</li>
    <li>Added NSS configuration to <code class="language-plaintext highlighter-rouge">configuration.nix</code> for hostname resolution</li>
    <li>Set default URI to avoid adding <code class="language-plaintext highlighter-rouge">-c qemu:///system</code> to every command</li>
    <li>Improved <code class="language-plaintext highlighter-rouge">clone_user_data</code> function with automatic folder creation</li>
    <li>Added repo with all functions</li>
  </ul>

  <p><strong>v2.0</strong></p>
  <ul>
    <li>Removed UFS images to avoid duplication (ZFS only)</li>
    <li>Added Fish-shell scripts to automate creation, destruction and network config</li>
    <li>Fixed IP assignment to VMs using MACs and hostnames</li>
    <li>Added KDE desktop environment setup via cloud-init</li>
    <li>Added Zerotier integration with self-authorization</li>
  </ul>

  <p><strong>v1.0</strong></p>
  <ul>
    <li>Initial guide with basic libvirtd setup</li>
    <li>UFS and ZFS image support</li>
    <li>Basic cloud-init configuration</li>
  </ul>

</details>

<h1 id="installing-libvirtd">Installing Libvirtd</h1>

<p>In <code class="language-plaintext highlighter-rouge">configuration.nix</code> you need to make the following changes.</p>

<div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add the user to these groups</span>
<span class="nv">users</span><span class="o">.</span><span class="nv">users</span><span class="o">.</span><span class="nv">maikel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">extraGroups</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"libvirtd"</span><span class="p">,</span> <span class="s2">"libvirt"</span><span class="p">,</span> <span class="s2">"qemu-libvirtd"</span> <span class="p">];</span>
<span class="p">};</span>

<span class="c"># Enable libvirtd</span>
<span class="nv">virtualisation</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">libvirtd</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">qemu</span><span class="o">.</span><span class="nv">vhostUserPackages</span> <span class="o">=</span> <span class="kn">with</span> <span class="nv">pkgs</span><span class="p">;</span> <span class="p">[</span> <span class="nv">virtiofsd</span> <span class="p">];</span>
    <span class="c"># Enable NSS plugin for resolving VM hostnames</span>
    <span class="nv">nss</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>        <span class="c"># classic libvirt NSS</span>
      <span class="nv">enableGuest</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>    <span class="c"># resolves domain names of guests</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="c"># Add Virt-Manager makes simpler to explore actual configs</span>
<span class="nv">programs</span><span class="o">.</span><span class="nv">virt-manager</span><span class="o">.</span><span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nv">environment</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">systemPackages</span> <span class="o">=</span> <span class="kn">with</span> <span class="nv">pkgs</span><span class="p">;</span> <span class="p">[</span>
    <span class="nv">virt-viewer</span>
    <span class="nv">cloud-utils</span>
    <span class="nv">cloud-init</span>
  <span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<h1 id="running-commands-when-using-libvirtd-as-a-systems-service">Running commands when using Libvirtd as a system‚Äôs service</h1>

<p>Despite all the changes there, I still need to prepend all virsh and virt-viewer commands with <code class="language-plaintext highlighter-rouge">-c qemu:///system</code>. One way to avoid having to do this is to set the environment variable.</p>

<p>For Fish shell:</p>

<pre><code class="language-fish"># Run this from anywhere, it automatically stores it in ~/.config/fish/fish_variables
set -Ux LIBVIRT_DEFAULT_URI qemu:///system
</code></pre>

<p>For Bash:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Append to ~/.bashrc or ~/.profile, whichever is the last to load on your system</span>
<span class="nb">export </span><span class="nv">LIBVIRT_DEFAULT_URI</span><span class="o">=</span><span class="s2">"qemu:///system"</span>
</code></pre></div></div>

<p>Alternatively, you can use Fish abbreviations (which I prefer because they show you the full command):</p>

<pre><code class="language-fish"># Add to ~/.config/fish/conf.d/abbreviations.fish
abbr --add virt-viewer "virt-viewer -c qemu:///system"
abbr --add virsh "virsh -c qemu:///system"
</code></pre>

<p>I like <code class="language-plaintext highlighter-rouge">abbr</code> instead of <code class="language-plaintext highlighter-rouge">alias</code> because with <code class="language-plaintext highlighter-rouge">abbr</code> <strong>I don‚Äôt actually forget</strong> the full command ever. It‚Äôs shown to me every time.</p>

<h1 id="configuring-the-network">Configuring the Network</h1>

<p>By default there‚Äôs nothing running network wise. So you need to start the default network with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Starts it if you can't see any new networks in ifconfig</span>
virsh net-start default

<span class="c"># So it autostarts</span>
virsh net-autostart default
</code></pre></div></div>

<p>That will run the virtual network every time the PC reboots.</p>

<h2 id="modifying-the-default-network-to-your-desired-ip-range">Modifying the default network to your desired IP range</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virsh net-dumpxml default <span class="o">&gt;</span> mynetwork.xml
</code></pre></div></div>

<p>We get this from it on the file <code class="language-plaintext highlighter-rouge">mynetwork.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;network&gt;</span>
  <span class="nt">&lt;name&gt;</span>default<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;uuid&gt;</span>07c8b831-3fa7-4bb1-ae07-fad64b672a67<span class="nt">&lt;/uuid&gt;</span>
  <span class="nt">&lt;forward</span> <span class="na">mode=</span><span class="s">'nat'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nat&gt;</span>
      <span class="nt">&lt;port</span> <span class="na">start=</span><span class="s">'1024'</span> <span class="na">end=</span><span class="s">'65535'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/nat&gt;</span>
  <span class="nt">&lt;/forward&gt;</span>
  <span class="nt">&lt;bridge</span> <span class="na">name=</span><span class="s">'virbr0'</span> <span class="na">stp=</span><span class="s">'on'</span> <span class="na">delay=</span><span class="s">'0'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;mac</span> <span class="na">address=</span><span class="s">'52:54:00:9f:f9:f6'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ip</span> <span class="na">address=</span><span class="s">'192.168.122.1'</span> <span class="na">netmask=</span><span class="s">'255.255.255.0'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dhcp&gt;</span>
      <span class="nt">&lt;range</span> <span class="na">start=</span><span class="s">'192.168.122.2'</span> <span class="na">end=</span><span class="s">'192.168.122.254'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/dhcp&gt;</span>
  <span class="nt">&lt;/ip&gt;</span>
<span class="nt">&lt;/network&gt;</span>
</code></pre></div></div>

<p>I‚Äôm going to change the range to <code class="language-plaintext highlighter-rouge">192.168.100.0/24</code> and the network name to <code class="language-plaintext highlighter-rouge">maikenet</code> since I like it more and tells me on the name what it is. You can remove UUID.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;network&gt;</span>
  <span class="nt">&lt;name&gt;</span>maikenet<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;forward</span> <span class="na">mode=</span><span class="s">'nat'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nat&gt;</span>
      <span class="nt">&lt;port</span> <span class="na">start=</span><span class="s">'1024'</span> <span class="na">end=</span><span class="s">'65535'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/nat&gt;</span>
  <span class="nt">&lt;/forward&gt;</span>
  <span class="nt">&lt;bridge</span> <span class="na">name=</span><span class="s">'virbr0'</span> <span class="na">stp=</span><span class="s">'on'</span> <span class="na">delay=</span><span class="s">'0'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;mac</span> <span class="na">address=</span><span class="s">'52:54:00:9f:f9:f6'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ip</span> <span class="na">address=</span><span class="s">'192.168.100.1'</span> <span class="na">netmask=</span><span class="s">'255.255.255.0'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dhcp&gt;</span>
      <span class="nt">&lt;range</span> <span class="na">start=</span><span class="s">'192.168.100.2'</span> <span class="na">end=</span><span class="s">'192.168.100.254'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/dhcp&gt;</span>
  <span class="nt">&lt;/ip&gt;</span>
<span class="nt">&lt;/network&gt;</span>
</code></pre></div></div>

<p>Now let‚Äôs destroy the network interface and create a new one. Beware if you‚Äôre doing these commands while your machines are running and attached to any network you‚Äôre destroying, they might need a reboot to recover their IPs once that network is back up.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># To destroy it</span>
virsh net-destroy default

<span class="c"># We need to undefine it in case something is assigned to it already but also because we're not using it anymore</span>
virsh net-undefine default

<span class="c"># To recreate it from file</span>
virsh net-define mynetwork.xml

<span class="c"># Now start it and autostart to ensure it starts with NixOS</span>
virsh net-start maikenet
virsh net-autostart maikenet

<span class="c"># Check with an ifconfig</span>
ifconfig
<span class="c"># You should see an adapter virbr0 with the right IP</span>
</code></pre></div></div>

<h1 id="creating-a-cloud-init-enabled-image">Creating a cloud-init enabled image</h1>

<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">
    <p><strong>IMPORTANT</strong></p>

    <p>Always download the VM version, not the installer version from https://www.freebsd.org/where/</p>
  </div></div>

<h2 id="for-a-zfs-vm-image">For a ZFS VM image</h2>

<p>This will create a template on your PC to run cloud-init from the ZFS VM image that uses ZFS filesystem, <strong>the most common case.</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Make a folder for your vms</span>
<span class="nb">mkdir</span> <span class="nv">$HOME</span>/vms
<span class="nb">cd</span> <span class="nv">$HOME</span>/vms

<span class="c"># Download standard VM image and unzip it</span>
wget https://download.freebsd.org/releases/VM-IMAGES/14.3-RELEASE/amd64/Latest/FreeBSD-14.3-RELEASE-amd64-zfs.qcow2.xz

<span class="c"># Decompress but keeps the original</span>
xz <span class="nt">-dk</span> FreeBSD-14.3-RELEASE-amd64-zfs.qcow2.xz

<span class="c"># Make the disk slightly bigger</span>
<span class="nb">mv </span>FreeBSD-14.3-RELEASE-amd64-zfs.qcow2 freebsd14-cloud-init-zfs.qcow2
qemu-img resize freebsd14-cloud-init-zfs.qcow2 10G

<span class="c"># Run it with the network to install CloudInit</span>
virt-install <span class="se">\</span>
  <span class="nt">--name</span> freebsd-zfs <span class="se">\</span>
  <span class="nt">--memory</span> 2048 <span class="se">\</span>
  <span class="nt">--vcpus</span> 2 <span class="se">\</span>
  <span class="nt">--disk</span> <span class="nv">path</span><span class="o">=</span>freebsd14-cloud-init-zfs.qcow2,format<span class="o">=</span>qcow2,bus<span class="o">=</span>virtio <span class="se">\</span>
  <span class="nt">--os-variant</span> freebsd14.0 <span class="se">\</span>
  <span class="nt">--import</span> <span class="se">\</span>
  <span class="nt">--network</span> <span class="nv">network</span><span class="o">=</span>maikenet,model<span class="o">=</span>virtio <span class="se">\</span>
  <span class="nt">--graphics</span> spice
</code></pre></div></div>

<h2 id="now-inside-the-machine">Now inside the machine</h2>

<p>The default root user is passwordless so if you use <code class="language-plaintext highlighter-rouge">root</code> it won‚Äôt ask for any password, just log you in.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OPTIONAL: Keyboard to Spanish, symbols are in different places</span>
kbdcontrol <span class="nt">-l</span> es

<span class="c"># Now inside the machine prepare it for cloud-init (as root, no pass)</span>
pkg update
pkg search cloud-init
pkg <span class="nb">install</span> <span class="nt">-y</span> WHATEVER_VERSION_YOU_GOT_FROM_SEARCH

<span class="c"># Now enable it</span>
sysrc <span class="nv">cloudinit_enable</span><span class="o">=</span><span class="s2">"YES"</span>
poweroff

<span class="c"># On your host system: Back it up</span>
xz <span class="nt">-k</span> freebsd14-cloud-init-zfs.qcow2
</code></pre></div></div>

<h1 id="using-your-own-templates-to-launch-custom-made-vms-easily">Using your own templates to launch custom-made VMs easily</h1>

<h2 id="create-a-cloud-init-config">Create a cloud-init config</h2>

<p>The SSH key I have there is the default one I have in SSH part of my home-manager config.</p>

<ol>
  <li>Create this file as <code class="language-plaintext highlighter-rouge">user-data.yaml</code> on the <code class="language-plaintext highlighter-rouge">$HOME/vms</code> folder as the basic template for all other machines:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cloud-config</span>
<span class="na">hostname</span><span class="pi">:</span> <span class="s">freebsd1</span>
<span class="na">users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">maikel</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">/usr/local/bin/fish</span>
    <span class="na">sudo</span><span class="pi">:</span> <span class="s">ALL=(ALL) NOPASSWD:ALL</span>
    <span class="na">lock_passwd</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="c1"># Use mkpasswd -m sha-512 to get this</span>
    <span class="na">passwd</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$6$L80IKTwDwcfp......josH0"</span>
    <span class="na">ssh_authorized_keys</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ssh-ed25519 AAAA......ikel.dev</span>
<span class="na">ssh_pwauth</span><span class="pi">:</span> <span class="s">True</span>
<span class="na">keyboard</span><span class="pi">:</span>
  <span class="na">layout</span><span class="pi">:</span> <span class="s">es</span>
<span class="na">packages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">fish</span>
  <span class="pi">-</span> <span class="s">sudo</span>
  <span class="pi">-</span> <span class="s">mkpasswd</span>
  <span class="pi">-</span> <span class="s">neovim</span>
  <span class="pi">-</span> <span class="s">ncdu</span>
  <span class="pi">-</span> <span class="s">git</span>
<span class="na">runcmd</span><span class="pi">:</span>
  <span class="c1"># Enable SSH</span>
  <span class="pi">-</span> <span class="s">sysrc sshd_enable=YES</span>
  <span class="pi">-</span> <span class="s">service sshd start</span>
  <span class="c1"># OPTIONAL: Set Spanish keyboard permanently</span>
  <span class="pi">-</span> <span class="s">sysrc keymap="es.kbd"</span>
  <span class="pi">-</span> <span class="s">service syscons restart</span>
  <span class="c1"># OPTIONAL: set root and maikel shells to fish explicitly</span>
  <span class="pi">-</span> <span class="s">pw usermod root -s /usr/local/bin/fish</span>
  <span class="pi">-</span> <span class="s">pw usermod maikel -s /usr/local/bin/fish</span>
  <span class="c1"># OPTIONAL: Auto resize main partition</span>
  <span class="pi">-</span> <span class="s">gpart recover vtbd0</span>
  <span class="pi">-</span> <span class="s">gpart resize -i 4 vtbd0</span>
  <span class="pi">-</span> <span class="s">zpool online -e zroot /dev/vtbd0p4</span>
</code></pre></div></div>

<ol>
  <li>Use this command to create a CD-ROM ISO to launch it from. Assuming you‚Äôre in <code class="language-plaintext highlighter-rouge">$HOME/vms</code>:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cloud-localds seed.iso user-data.yaml
</code></pre></div></div>

<h2 id="creating-the-final-machine-using-the-zfs-image">Creating the final machine using the ZFS image</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Access the folder of your vms</span>
<span class="nb">cd</span> <span class="nv">$HOME</span>/vms

<span class="c"># Decompress the fresh cloud-init-enabled version we created before</span>
xz <span class="nt">-dk</span> freebsd14-cloud-init-zfs.qcow2.xz

<span class="c"># Rename it to something more useful to distinguish it from the template</span>
<span class="nb">cp </span>freebsd14-cloud-init-zfs.qcow2 freebsd1.qcow2

<span class="c"># Create the seed ISO from user-data.yaml in case you've made any changes</span>
cloud-localds freebsd1.iso user-data.yaml

<span class="c"># Make the disk bigger here it is set to 20G but you can do whatever size you like</span>
qemu-img resize freebsd1.qcow2 50G

virt-install <span class="se">\</span>
  <span class="nt">--name</span> freebsd1 <span class="se">\</span>
  <span class="nt">--memory</span> 4096 <span class="se">\</span>
  <span class="nt">--vcpus</span> 4 <span class="se">\</span>
  <span class="nt">--disk</span> <span class="nv">path</span><span class="o">=</span>freebsd1.qcow2,format<span class="o">=</span>qcow2,bus<span class="o">=</span>virtio <span class="se">\</span>
  <span class="nt">--disk</span> <span class="nv">path</span><span class="o">=</span>freebsd1.iso,device<span class="o">=</span>cdrom <span class="se">\</span>
  <span class="nt">--os-variant</span> freebsd14.0 <span class="se">\</span>
  <span class="nt">--import</span> <span class="se">\</span>
  <span class="nt">--network</span> <span class="nv">network</span><span class="o">=</span>maikenet,model<span class="o">=</span>virtio <span class="se">\</span>
  <span class="nt">--graphics</span> spice <span class="se">\</span>
  <span class="nt">--noautoconsole</span>
</code></pre></div></div>

<p>And that‚Äôs it, your system should be up and running ready to be used. Because you enabled NSS and added your default SSH key (default in <code class="language-plaintext highlighter-rouge">.ssh/config</code>), you can just log into it with a simple:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh maikel@freebsd1
</code></pre></div></div>

<p>‚Ä¶once the machine finishes running all of its cloud-init script.</p>

<p><img src="/assets/images/2025/09/image-4.png" alt="Image" /></p>

<h1 id="extra-steps-for-your-own-sanity">Extra steps for your own sanity</h1>

<h2 id="resizing-the-partition-to-use-all-available-space-zfs">Resizing the partition to use all available space (ZFS)</h2>

<p>If you want your system to use all the available space in your qcow2 file after resizing it you‚Äôll need some extra steps. This can all be added on the user-data template though which I did so you don‚Äôt need to.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure vtbd0 is the name of it</span>
gpart show

<span class="c"># Resize partition</span>
gpart recover vtbd0

<span class="c"># Get the slice or number of partition, in my case is 4</span>
gpart show

<span class="c"># This is assuming the slice is 4</span>
gpart resize <span class="nt">-i</span> 4 vtbd0

<span class="c"># Again the end "p4" depends on the slice number</span>
zpool online <span class="nt">-e</span> zroot /dev/vtbd0p4

<span class="c"># Check with</span>
zpool list
</code></pre></div></div>

<p>That‚Äôs all your machine is ready to use. If you ever need to change the size of the qcow2 file repeat those steps.</p>

<h2 id="autostart-this-machine-with-nixos">Autostart this machine with NixOS</h2>

<p>Run on the host machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virsh autostart freebsd1
</code></pre></div></div>

<p>Otherwise to start manually:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virsh start freebsd1
</code></pre></div></div>

<h2 id="detach-cloud-init-disk-just-in-case">Detach cloud-init disk just in case</h2>

<p>Normally cloud-init runs only once, but just to be sure on the host machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># To find the name of the ISO device, in my case "hda"</span>
virsh domblklist freebsd1

<span class="c"># To both remove it and ensure it never comes back after reboot</span>
virsh change-media freebsd1 hda <span class="nt">--eject</span> <span class="nt">--config</span> <span class="nt">--live</span>
</code></pre></div></div>

<h2 id="cloning-user-data">Cloning user data</h2>

<p>I create this mostly because I was considering the Zerotier one that is far below and realised I can kill two birds with one shot.</p>

<pre><code class="language-fish">function clone_user_data
  if test (count $argv) -ne 1
    echo "Usage: clone_user_data &lt;vmname&gt;"
    return 1
  end

  set NEWVM $argv[1]
  set BASE "$HOME/vms/user-data.yaml"
  set vm_dir $HOME/vms/in_use/$vm
  mkdir -p $vm_dir
  set OUT "$vm_dir/$NEWVM-user-data.yaml"

  if not test -f $BASE
    echo "Error: base file $BASE does not exist"
    return 1
  end

  # Replace hostname line
  sed "s/^hostname:.*/hostname: $NEWVM/" $BASE &gt; $OUT
  echo "Created config: $OUT"
end
</code></pre>

<h2 id="creating-machines-quickly-with-fish-function">Creating machines quickly with Fish function</h2>

<p>At the moment I separate creating the user-data file for that machine from creating it because precisely we might want to change what is installed on the machine. So this is how I normally do it now:</p>

<pre><code class="language-fish"># Assuming decompressed ready cloud image on ~/vms
# Create a user-data file for that machine
clone_user_data freebsd4

# Edit it
vi $HOME/vms/in_use/freebsd4/freebsd4-user-data.yaml

# Create the machine
create_vm freebsd4
</code></pre>

<p>Then create the machine:</p>

<pre><code class="language-fish">function create_vm
  if test (count $argv) -lt 1
    echo "Usage: createvm &lt;vm-name&gt;"
    return 1
  end

  set vm $argv[1]
  set vm_dir $HOME/vms/in_use/$vm
  cd $vm_dir

  echo "Copying template to VM disk..."
  cp $HOME/vms/freebsd14-cloud-init-zfs.qcow2 $vm.qcow2

  echo "Creating seed ISO..."
  cloud-localds $vm.iso $vm-user-data.yaml

  echo "Resizing disk..."
  qemu-img resize $vm.qcow2 20G

  echo "Launching VM..."
  virt-install \
    --connect qemu:///system \
    --name $vm \
    --memory 4096 \
    --vcpus 4 \
    --disk path=$vm.qcow2,format=qcow2,bus=virtio \
    --disk path=$vm.iso,device=cdrom \
    --os-variant freebsd14.0 \
    --import \
    --network network=maikenet,model=virtio \
    --graphics spice \
    --noautoconsole

  echo "VM $vm launched."
end
</code></pre>

<h2 id="destroying-machines-quickly-with-fish-shell">Destroying machines quickly with Fish shell</h2>

<pre><code class="language-fish">function destroy_vm
  if test (count $argv) -lt 1
    echo "Usage: destroyvm &lt;vm-name&gt;"
    return 1
  end

  set vm $argv[1]
  echo "Destroying VM $vm..."
  virsh destroy $vm

  echo "Undefining VM $vm..."
  virsh undefine $vm

  set disk ~/vms/in_use/$vm/$vm.qcow2
  set seed ~/vms/in_use/$vm/$vm.iso
  set userdata ~/vms/in_use/$vm/$vm-user-data.yaml

  if test -f $disk
    echo "Deleting disk $disk..."
    rm -f $disk
  else
    echo "Disk $disk not found, skipping."
  end

  if test -f $seed
    echo "Deleting seed $seed..."
    rm -f $seed
  else
    echo "Disk $seed not found, skipping."
  end

  if test -f $userdata
    echo "Deleting user-data $userdata..."
    rm -f $userdata
  else
    echo "Disk $userdata not found, skipping."
  end

  rm -rf $HOME/vms/in_use/$vm
end
</code></pre>

<h2 id="zerotier-on-creation-with-self-authorisation">Zerotier on creation with self-authorisation</h2>

<p>This is something I‚Äôm experimenting with, installing Zerotier and joining a network are easy steps but I want it to self-authorise too. It does works as it currently is but I want the variables to be fed into the cloud config somehow instead of hard-coding the variables.</p>

<p>Then once the machine is up and running you can just and simply run <code class="language-plaintext highlighter-rouge">/root/join-network.sh</code> as root.</p>

<p>I set a few variables to simplify this all, for example I want the fish functions to be in the vm folder as they are all related to this.</p>

<pre><code class="language-fish"># This loads functions from the path in the vms add to config.fish
set -g fish_function_path $fish_function_path ~/vms/fish_functions

# This sets the default password I want to use for my machines which is later hashed by mkpasswd, can be set from the shell
set -Ua DEFAULT_VM_PASSWORD whatever_passw_you_want
</code></pre>

<p>I also did a few more changes here and in the cloning function since now this is my standard user-data.yaml template:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cloud-config</span>
<span class="na">hostname</span><span class="pi">:</span> 
<span class="na">users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">maikel</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">/usr/local/bin/fish</span>
    <span class="na">sudo</span><span class="pi">:</span> <span class="s">ALL=(ALL) NOPASSWD:ALL</span>
    <span class="na">lock_passwd</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">passwd</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">ssh_authorized_keys</span><span class="pi">:</span>
      <span class="pi">-</span> 
<span class="na">ssh_pwauth</span><span class="pi">:</span> <span class="s">True</span>
<span class="na">keyboard</span><span class="pi">:</span>
  <span class="na">layout</span><span class="pi">:</span> <span class="s">es</span>
<span class="na">packages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">fish</span>
  <span class="pi">-</span> <span class="s">sudo</span>
  <span class="pi">-</span> <span class="s">mkpasswd</span>
  <span class="pi">-</span> <span class="s">neovim</span>
  <span class="pi">-</span> <span class="s">ncdu</span>
  <span class="pi">-</span> <span class="s">zerotier</span>
  <span class="pi">-</span> <span class="s">curl</span>
  <span class="pi">-</span> <span class="s">jq</span>
<span class="na">write_files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/root/join-network.sh</span>
    <span class="na">permissions</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0755'</span>
    <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">#!/bin/sh</span>
      <span class="s">zerotier-cli join "" &amp;&amp; \</span>
      <span class="s">MEMBER_ID=$(zerotier-cli info | awk '{print $3}') &amp;&amp; \</span>
      <span class="s">curl -H "Authorization: token " -X POST \</span>
      <span class="s">"https://api.zerotier.com/api/v1/network//member/$MEMBER_ID" \</span>
      <span class="s">--data '{"config": {"authorized": true}}'</span>
<span class="na">runcmd</span><span class="pi">:</span>
  <span class="c1"># Enable SSH</span>
  <span class="pi">-</span> <span class="s">sysrc sshd_enable=YES</span>
  <span class="pi">-</span> <span class="s">service sshd start</span>
  <span class="c1"># Set Spanish keyboard permanently</span>
  <span class="pi">-</span> <span class="s">sysrc keymap="es.kbd"</span>
  <span class="pi">-</span> <span class="s">service syscons restart</span>
  <span class="c1"># Optional: set root and maikel shells to fish explicitly</span>
  <span class="pi">-</span> <span class="s">pw usermod root -s /usr/local/bin/fish</span>
  <span class="pi">-</span> <span class="s">pw usermod maikel -s /usr/local/bin/fish</span>
  <span class="c1"># Auto resize main partition</span>
  <span class="pi">-</span> <span class="s">gpart recover vtbd0</span>
  <span class="pi">-</span> <span class="s">gpart resize -i 4 vtbd0</span>
  <span class="pi">-</span> <span class="s">zpool online -e zroot /dev/vtbd0p4</span>
  <span class="c1"># Zerotier joy</span>
  <span class="pi">-</span> <span class="s">sysrc zerotier_enable="YES"</span>
  <span class="pi">-</span> <span class="s">service zerotier start</span>
</code></pre></div></div>

<p>Applying the ZT_TOKEN and ZT_NW with a Fish-shell function <code class="language-plaintext highlighter-rouge">clone_user_data VM_NAME</code>:</p>

<pre><code class="language-fish">function clone_user_data
  if test (count $argv) -ne 1
    echo "Usage: clone_user_data &lt;vmname&gt;"
    return 1
  end

  set NEWVM $argv[1]
  set BASE "$HOME/vms/user-data.yaml"
  set VM_DIR "$HOME/vms/in_use/$NEWVM"
  mkdir -p "$VM_DIR"
  echo "Created directory $VM_DIR"

  set OUT "$VM_DIR/$NEWVM-user-data.yaml"

  if not test -f $BASE
    echo "Error: base file $BASE does not exist"
    return 1
  end

  if test -z "$ZT_TOKEN"
    echo "Error: ZT_TOKEN environment variable not set"
    return 1
  end

  if test -z "$ZT_NWID"
    echo "Error: ZT_NWID environment variable not set"
    return 1
  end

  if test -z "$DEFAULT_VM_PASSWORD"
    echo "Error: DEFAULT_VM_PASSWORD environment variable not set"
    return 1
  end

  # Generate hashed password
  set PASSWD (mkpasswd -m sha-512 $DEFAULT_VM_PASSWORD)

  # Extract default identity file from ssh config (already a .pub in your setup)
  set PUBKEYFILE (grep -m1 -i 'IdentityFile' ~/.ssh/config | awk '{print $2}' | sed "s|~|$HOME|")

  if test -z "$PUBKEYFILE"
    echo "Error: could not find IdentityFile in ~/.ssh/config"
    return 1
  end

  if not test -f $PUBKEYFILE
    echo "Error: public key $PUBKEYFILE not found"
    return 1
  end

  set PUBKEY (cat $PUBKEYFILE)

  sed \
    -e "s||$NEWVM|g" \
    -e "s||$ZT_NWID|g" \
    -e "s||$ZT_TOKEN|g" \
    -e "s||$PASSWD|g" \
    -e "s||$PUBKEY|" \
    $BASE &gt;$OUT

  if test $status -ne 0
    echo "Error: failed to generate $OUT"
    return 1
  end

  echo "Created config: $OUT"
end
</code></pre>

<h2 id="installing-a-desktop-environment">Installing a desktop environment</h2>

<p>I use KDE, it really just needs to read the handbook and follow it step by step. I even created its own <code class="language-plaintext highlighter-rouge">desktop-user-data.yaml</code> file for this one in case I ever need the desktop.</p>

<p>The yaml file for cloudinit:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cloud-config</span>
<span class="na">hostname</span><span class="pi">:</span> <span class="s">desktop</span>
<span class="na">users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">maikel</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">/usr/local/bin/fish</span>
    <span class="na">sudo</span><span class="pi">:</span> <span class="s">ALL=(ALL) NOPASSWD:ALL</span>
    <span class="na">lock_passwd</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">passwd</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$6$L80IKTw............osH0"</span>
    <span class="na">ssh_authorized_keys</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ssh-ed25519 ....... maikel.dev</span>
<span class="na">ssh_pwauth</span><span class="pi">:</span> <span class="s">True</span>
<span class="na">keyboard</span><span class="pi">:</span>
  <span class="na">layout</span><span class="pi">:</span> <span class="s">es</span>
<span class="na">packages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">fish</span>
  <span class="pi">-</span> <span class="s">sudo</span>
  <span class="pi">-</span> <span class="s">mkpasswd</span>
  <span class="pi">-</span> <span class="s">neovim</span>
  <span class="pi">-</span> <span class="s">ncdu</span>
  <span class="pi">-</span> <span class="s">xorg</span>
  <span class="pi">-</span> <span class="s">kde</span>
  <span class="pi">-</span> <span class="s">sddm</span>
<span class="na">runcmd</span><span class="pi">:</span>
  <span class="c1"># Enable SSH</span>
  <span class="pi">-</span> <span class="s">sysrc sshd_enable=YES</span>
  <span class="pi">-</span> <span class="s">service sshd start</span>
  <span class="c1"># Set Spanish keyboard permanently</span>
  <span class="pi">-</span> <span class="s">sysrc keymap="es.kbd"</span>
  <span class="pi">-</span> <span class="s">service syscons restart</span>
  <span class="c1"># Optional: set root and maikel shells to fish explicitly</span>
  <span class="pi">-</span> <span class="s">pw usermod root -s /usr/local/bin/fish</span>
  <span class="pi">-</span> <span class="s">pw usermod maikel -s /usr/local/bin/fish</span>
  <span class="c1"># Auto resize main partition</span>
  <span class="pi">-</span> <span class="s">gpart recover vtbd0</span>
  <span class="pi">-</span> <span class="s">gpart resize -i 4 vtbd0</span>
  <span class="pi">-</span> <span class="s">zpool online -e zroot /dev/vtbd0p4</span>
  <span class="c1"># Add KDE</span>
  <span class="pi">-</span> <span class="s">pw groupmod video -m maikel</span>
  <span class="pi">-</span> <span class="s">sysrc dbus_enable="YES"</span>
  <span class="pi">-</span> <span class="s">service dbus start</span>
  <span class="pi">-</span> <span class="s">sysctl net.local.stream.recvspace=65536</span>
  <span class="pi">-</span> <span class="s">sysctl net.local.stream.sendspace=65536</span>
  <span class="pi">-</span> <span class="s">sysctl -f /etc/sysctl.conf</span>
  <span class="pi">-</span> <span class="s">sysrc sddm_enable="YES"</span>
  <span class="pi">-</span> <span class="s">sysrc sddm_lang="es_ES"</span>
  <span class="pi">-</span> <span class="s">setxkbmap -layout es</span>
  <span class="pi">-</span> <span class="s">service ssdm start</span>
</code></pre></div></div>

<p>The machine has a few differences, I assigned more total system memory (8GB) and hiked the RAM assigned to the video card too. My mouse is a USB one so only works with that line in input. If yours isn‚Äôt USB delete that line.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virt-install <span class="se">\</span>
  <span class="nt">--connect</span> qemu:///system <span class="se">\</span>
  <span class="nt">--name</span> desktop <span class="se">\</span>
  <span class="nt">--memory</span> 8192 <span class="se">\</span>
  <span class="nt">--vcpus</span> 4 <span class="se">\</span>
  <span class="nt">--disk</span> <span class="nv">path</span><span class="o">=</span>desktop.qcow2,format<span class="o">=</span>qcow2,bus<span class="o">=</span>virtio <span class="se">\</span>
  <span class="nt">--disk</span> <span class="nv">path</span><span class="o">=</span>desktop.iso,device<span class="o">=</span>cdrom <span class="se">\</span>
  <span class="nt">--os-variant</span> freebsd14.0 <span class="se">\</span>
  <span class="nt">--import</span> <span class="se">\</span>
  <span class="nt">--video</span> qxl,ram<span class="o">=</span>524288,vram<span class="o">=</span>262144,vgamem<span class="o">=</span>262144 <span class="se">\</span>
  <span class="nt">--network</span> <span class="nv">network</span><span class="o">=</span>maikenet,model<span class="o">=</span>virtio,mac<span class="o">=</span>52:54:00:6f:3c:58 <span class="se">\</span>
  <span class="nt">--input</span> <span class="nb">type</span><span class="o">=</span>mouse,bus<span class="o">=</span>usb <span class="se">\</span>
  <span class="nt">--graphics</span> spice <span class="se">\</span>
  <span class="nt">--noautoconsole</span>
</code></pre></div></div>

<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">
    <p>The Fish function <strong>create_vm</strong> won‚Äôt work for this because the definition is for a non-GUI machine. But you can use the Fish function <strong>clone_user_data</strong> to get the MAC and fix the IP. Since this was a one off, I didn‚Äôt care about automating it. As soon as I discovered the <strong>hours-long</strong> nightmare that is <a href="https://freebsdfoundation.org/resource/how-to-use-vs-code-on-freebsd/">installing VSCode in FreeBSD</a> I realised I‚Äôm only using it for servers and appliances.</p>
  </div></div>

<h2 id="cleaning-up">Cleaning up</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># See the machines</span>
<span class="nb">sudo </span>virsh list <span class="nt">--all</span>

<span class="c"># The first stops immediately the machine</span>
<span class="nb">sudo </span>virsh destroy freebsd14

<span class="c"># This second removes it from the pool of VMs of libvirtd</span>
<span class="nb">sudo </span>virsh undefine freebsd14

<span class="c"># Delete any pre-made seed just in case</span>
<span class="nb">rm</span> <span class="nt">-rf</span> seed.iso
</code></pre></div></div>

<h1 id="extra-repo-with-all-this">Extra: Repo with all this</h1>

<p>I made a repo with all these commands including a pre-made ZFS-ready FreeBSD 14.3 image.</p>

<p>The URL is <a href="https://github.com/maikelthedev/libvirtd_automation">https://github.com/maikelthedev/libvirtd_automation</a></p>

<h1 id="some-oddities">Some oddities</h1>

<p>These are some painful parts from the process.</p>

<h2 id="the-command-virt-install-and-">The command <code class="language-plaintext highlighter-rouge">virt-install</code> and ‚Äú~‚Äù</h2>

<p>I don‚Äôt know why the path can‚Äôt interpret ‚Äú~‚Äù hence why I did it all from the <code class="language-plaintext highlighter-rouge">$HOME/vms</code> folder. In this version I changed ‚Äú~‚Äù to <code class="language-plaintext highlighter-rouge">$HOME</code> in all scripts for consistency.</p>

<h2 id="run-without-virt-viewer">Run without virt-viewer</h2>

<p>Sometimes you want to install and see nothing, in those case use:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--graphics</span> spice <span class="se">\</span>
<span class="nt">--noautoconsole</span>
</code></pre></div></div>

<p>At the end of the <code class="language-plaintext highlighter-rouge">virt-install</code> command, this runs the system with graphics enable but doesn‚Äôt attach any viewer to it.</p>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="FreeBSD" /><category term="NixOS" /><category term="DevOps" /><category term="virtualization" /><summary type="html"><![CDATA[Complete guide to running FreeBSD alongside NixOS using libvirtd, with automation scripts, network configuration, cloud-init setup, and desktop environment installation.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1657724576853.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1657724576853.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Living Out Loud With ADHD ‚Äì Episode 2: Elvanse 2nd attempt</title><link href="https://blog.maikel.dev/2025/09/19/living-out-loud-with-adhd-episode-2-elvanse-2nd-attempt.html" rel="alternate" type="text/html" title="Living Out Loud With ADHD ‚Äì Episode 2: Elvanse 2nd attempt" /><published>2025-09-19T00:00:00+02:00</published><updated>2025-09-19T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/09/19/living-out-loud-with-adhd-episode-2-elvanse-2nd-attempt</id><content type="html" xml:base="https://blog.maikel.dev/2025/09/19/living-out-loud-with-adhd-episode-2-elvanse-2nd-attempt.html"><![CDATA[<h1 id="some-necesary-background">Some necesary background</h1>

<p>Quick mandatory reminder üëá</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">‚ö†Ô∏è</div><div class="kg-callout-text">**This is not medical information, **nor am I a trained physician or any kind of expert in ADHD. I'm just another ADHDer untangling the data I got and detailing my own personal experience and effects (if any) of meds. 

If you think any of this relates to you, don't take it on your own hands, discuss it with your doctor. If any of it particularly helped you or you think I might be on the wrong track feel free to let me know. Interactions are **encouraged**.</div></div>
<p>Ont the <a href="/adhd-changes-ch-1-week-34/">first episode of these series of post about living with ADHD</a> I wrote at length of why I didn‚Äôt like Elvanse. But let me summarise it quickly back here</p>

<h2 id="the-bad-stuff">The bad stuff</h2>

<ul>
  <li>Task initiation was easy but task maintenance hard. Working was hard with it.</li>
  <li>Alters my immune system, the main problem is with my hidradenitis (stage 2), it literally gives me cysts on both of my armpits.</li>
  <li>I sleep very short time so eventually feel too exhausted. Three to four hours only every night.</li>
  <li>Inconsistent results.</li>
  <li>Waking up physically exhausted.</li>
</ul>

<h2 id="the-good-stuff">The good stuff</h2>

<ul>
  <li>Emotional regulation is superior than with Medikinet.</li>
  <li>The first day is always consistently perfect.</li>
  <li>I get a much more flexible attention span. Instead of being like a laser focus on Medikinet. I can plan things, whereas with Medikinet my plans need to be written down ahead of taking the pill.</li>
</ul>

<h2 id="the-way-ive-been-taking-it">The way I‚Äôve been taking it</h2>

<p>On weekends when we‚Äôre more social because of the superior emotional regulation specially and because also that‚Äôs when I do general cleaning of my home and I need to be able to keep a wider attention span. That‚Äôs when I often have swapped the Medikinet for Elvanse. Medikinet makes me an execution robot with zero creativity. Elvanse makes me <strong>me **minus the internal noise.</strong>Both **get rid of the internal distractions but Elvanse doesn‚Äôt make it hard to remember a simple to-do list.</p>

<h1 id="the-change">The change</h1>

<p>I really really started to dislike the <strong>limitations</strong> of Medikinet in terms of memory loss and memory access. I felt like wearing a strait jacket with it, I get it, if I want to code it works because I can just focus on coding and coding alone, but if that same day after coding, I want <strong>to have a life and **go out with friends I‚Äôm very limited and get increasingly **frustrated</strong>. I keep forgetting words, my keys, if I had taken my pills, I get ADHD symptons that I don‚Äôt have without it. And after its effects more than 8 hours later I can‚Äôt stop devouring calories. It makes me really hungry.</p>

<p>So I thought deeply, now that I know better about teh behavioral changes that I had to implement, specially for task initiation and task maintenance. Why not give a go back to Elvanse with some important difference: <strong>focus on sleep.</strong></p>

<h2 id="the-rationale-for-the-experiment">The rationale for the experiment</h2>

<p>For all the bad I described above one was fixed when I re-learnt how to ensure I get locked in the task I actually wanted and not the first one I was doing (problem I eventually had with both pills not just Elvanse, I call it the Task Lock Awareness and will post more about this on the next episode) and that‚Äôs a behavioral change, that‚Äôs part of learning to operate as a neuronormative person.</p>
<div><div>üí≠</div><div>**Task Lock Awareness (TLA)** is my placeholder term for when you get stuck in a task far longer than planned. It‚Äôs not distraction‚Äîit‚Äôs the opposite. You lose awareness of time because the task absorbs you completely.

I think this comes from years of brute-forcing dopamine while unmedicated. Back then, starting anything felt like dragging water from a dry well‚Äîit took huge effort. Now, medicated, it‚Äôs more like working with a full reservoir. The water‚Äôs there, but our habits haven‚Äôt adjusted, so we keep over-pumping.

That‚Äôs why every task feels ‚Äútoo engaging.‚Äù We‚Äôre not used to a lighter touch, so we overdo it and get locked in. Hence: **Task Lock Awareness**.

The awareness is also my rudimentary solution to the task lock. But it needs to be maintained on your mind while you do any task to avoid overdoing them. </div></div>
<p>So that‚Äôs TLA and I kind of learnt how to fix it. But it‚Äôs so long to explain it needs its own post.</p>

<p>The other 4 issues I had with Elvanse** <strong>can be fixed if I sleep more. Enter the scene what I‚Äôve been using for years to sleep relatively consistently before I got my ADHD diagnose: **doxylamine **or **prometazine.</strong>In Spain I use <strong>doxylamine</strong> in the UK <strong>promethazine.</strong>They are both the same thing, first generation antihistaminics that were terrible for allergies but brilliant to help you fall asleep without being as damaging as actual hard-core sleeping pills (e.g: Ambien is dreadful).
<img src="/assets/images/2025/09/image-2.png" alt="Image" />
Yet I‚Äôm not doing this if it isn‚Äôt worth it. So where do I go? Anecdotal evidence (not scientifical) of other fellow Elvanse users. I literally just searched forums and Reddit on sleeping issues with Elvanse. The most common description being this
**I slept very poorly the first two weeks, then it got eventually better and I went back to sleeping normally&lt;/blockquote&gt;
I didn‚Äôt find it once or twice but repeatedly and with multiple people saying it was the same for them to the original poster. So I thought: let‚Äôs do an experiment under that assumption, take the doxilamine, force sleep for two weeks and see how I get on.</p>

<p>Also, every other day if I feel too energised I go for a 5K run. Today (4th day) I don‚Äôt feel like it so I‚Äôll go tomorrow. I take the doxilamine around 8pm and try to sleep as long as I can.</p>

<h1 id="the-early-results">The Early Results</h1>

<p>I‚Äôll complete this post later, since today I can only talk about the first four days but so far it‚Äôs completely different to the first time I sustained 5 days with it. Day after day after day I get this:</p>

<ol>
  <li>Consistent results day after day for the first time ever. Normally even just the second day it feels a lot less effective.</li>
  <li>I‚Äôm literally working everyday with no issues as far as I keep an awareness of the task lock on minor tasks, and avoid getting sucked into tasks that don‚Äôt generate an income.</li>
  <li>No cysts on armpits, it‚Äôs not triggering my HS stage 2.</li>
  <li>I‚Äôm not waking up exhausted.</li>
  <li>I get to do stuff the whole day, instead of just the 8 hours I get with Medikinet. I‚Äôm back at working also in the evening.</li>
</ol>

<p>So far that‚Äôs what I have. More on this soon. Feel free to give any feedback.</p>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="ADHD" /><summary type="html"><![CDATA[My experience with ADHD and what has been working so far ever since starting on medication. This episode is about the usage of Elvanse long-term.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1675524375084.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1675524375084.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Living Out Loud With ADHD ‚Äì Episode 1: A very thorough Introduction</title><link href="https://blog.maikel.dev/2025/08/18/adhd-changes-ch-1-week-34.html" rel="alternate" type="text/html" title="Living Out Loud With ADHD ‚Äì Episode 1: A very thorough Introduction" /><published>2025-08-18T00:00:00+02:00</published><updated>2025-08-18T00:00:00+02:00</updated><id>https://blog.maikel.dev/2025/08/18/adhd-changes-ch-1-week-34</id><content type="html" xml:base="https://blog.maikel.dev/2025/08/18/adhd-changes-ch-1-week-34.html"><![CDATA[<p>Quick mandatory reminder üëá</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">‚ö†Ô∏è</div><div class="kg-callout-text">**This is not medical information, **nor am I a trained physician or any kind of expert in ADHD. I'm just another ADHDer untangling the data I got and detailing my own personal experience and effects (if any) of meds. 

If you think any of this relates to you, don't take it on your own hands, discuss it with your doctor. If any of it particularly helped you or you think I might be on the wrong track feel free to let me know. Interactions are **encouraged**.</div></div>
<h1 id="background">Background</h1>

<p>I‚Äôll try to keep it short and sweet. My name is Maikel, I‚Äôm a 39 years cis gay man from Spain. I‚Äôve always struggled with sleep and from around 2018 increasingly with having any energy left past noon to continue doing any tasks that require focus. Which is bad because <a href="/">I‚Äôm a programmer.</a> I‚Äôve gone through valerian, melatonin, pills of all sorts and finally doxilamine. Somehow I settled for doxilamine every 3 days to move back my sleeping clock as it tends to shift each day later. Going to the gym first thing in the morning seems to help reach the bed at night tired enough.</p>

<p>I‚Äôve checked everything possible and more. Count with the fact I‚Äôm HIV+ and my CD4 are not at their best count. Let alone I‚Äôm on a 4-component medication. On top of that I have another autoimmune called hidradenitis suppurativa (stage 2) that causes major cysts to appear very quicly out of nowhere (can go from nothing to ping-pong ball size within a day) in my armpits and groin area. I have had several surgeries because of this and follow a strict and rigid routine to keep it at bay.</p>

<p>With all this backgorund let‚Äôs focus on the ADHD or how I reached diagnosis</p>

<h2 id="non-24-sleep-disorder">Non-24 Sleep Disorder</h2>

<p>Some definitions</p>
<div><div>üò¥</div><div>**Non-24-Hour Sleep‚ÄìWake Disorder **is a condition where your internal ‚Äúbody clock‚Äù runs a bit longer than the normal 24-hour day. Because of that, your natural bedtime drifts a little later each night‚Äîmaybe by 30 minutes, an hour, or more‚Äîso over days or weeks your sleep schedule slowly shifts around the clock. </div></div>
<p>My version (notice the wonderful usage of past tense üòÅ) shifts usually around 2 hours every day of extra wakefulness, sometimes a lot more. So I use to focus on the time I woke up (which meant some days I slept more, some days less) and if for too many days I slept too litle then take very early one doxilamine pill to sleep more hours and recover.</p>

<p>Of course that wasn‚Äôt sustainable but nobody did the proper check of why it happened.</p>

<h2 id="the-missdiagnosis">The missdiagnosis</h2>

<p>For a long time doctors thought I could have hyperthiroidism but every test they did came normal, and multiple doctors made multiple tests both in Spain and the UK, let alone it has now become part of what I get tested every 6 month as part of my regular HIV blood work.</p>

<p>Back in 2018 I finaly managed to quit smoking, it was a long trial and error process until it worked. For a long time after I quit smoking I had anhedonia. In hindsight I think I was using nicotine to treat my ADHD without knowing.</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">Anhedonia is the state of feeling little or no pleasure from activities or relationships that used to be enjoyable.</div></div>
<p>I already had the Non-24h Sleep Disorder, but it got a lot worse. Eventually got so bad for first time ever I spent 3 days unable to sleep and was sent to a psychiatrist. He took notes, asked me about my family mental history, asked about personal experiences I didn‚Äôt give any importance about (forgetting for 1 full minute about a place that I knew I should know like my hand, Richmond train station, while being there) and eventually reached the conclussion of Panic Disorder. He put me on Sertraline and Prometazine</p>

<p>Did it work? Kind of, I could finally sleep, but I didn‚Äôt like it at all. It felt like having this artificial euphoria all the time that I couldn‚Äôt turn off. Then the muscle cramps. And also the imposibility to orgasm. I hated it. After a few months I saw him again and he told me he thinks is more of a dopaminergic sensitivity. Since a panic disorder wouldn‚Äôt be cured with just meds, if it‚Äôs purely chemical and therefore problems with my dopamine. He thought I might produce too much of it because of family history. I did tell him his diagnose made no sense since I never feel panic, I just feel ‚Äúaccelerated‚Äù sometimes as if someone has pressed the release button of adrenaline out of nowhere. Anyway, I could sleep so I thought case closed. After a while he told me some ways to quit the Sertra and stay on Prometazine so I stayed on that one (much milder) and started my 1 pill every 3 day routine. In Spain there‚Äôs no prometazine but doxilamine, the effects are the same and both can be bought in the UK and Spain respectively over the counter.</p>

<h2 id="its-shifting-again">It‚Äôs shifting again</h2>

<p>Back to here ~March my clock started shifting stupidly again. Went again to a psychiatrist (my current one: Ariadna), uploaded her all the docs from my doctor in the UK and we started sertraline again and Zolpidem (more known as Ambien) to bring back to cyrchadiam rythm. It didn‚Äôt work, it made matters worse. And concentrating now at work became impossible.</p>

<h2 id="the-suspicion">The suspicion</h2>

<p>I get a message from my brother in law that my niece, who is identical to me, has been diagnosed ADHD. At first it didn‚Äôt make any sense to me, the one thing where we differ is that she‚Äôs impulsive, I‚Äôm not. But then I discovered there are 3 types of presentation of ADHD. That means the way the symptons can show. And one of them, which I didn‚Äôt know existed, fits everything including my problems to sleep or concentrate over long periods of time.</p>

<p>I got to a <a href="https://www.adxs.org/en">German site that has an english version</a> and start reading, educating myself and finding if there was something I could try before diagnosis to confirm my theory. I read the list of meds on the protocol and figure the easiest one to get was Bupropion. So I got it. Tried 150mg per day of it and from day 1 the changes were **magnificent **and for the first time ever I went to sleep unaided.</p>

<p>I also discovered that day ‚Äúputting your mind in blank‚Äù is not an idiom, but something neurotypicals can actually do.<strong>I literally cried for more than an hour.</strong></p>

<h2 id="finally-the-diagnosis">Finally the Diagnosis</h2>

<p>So I fork 400‚Ç¨ to go to a proper clinic and get assessed by a team of one psychiatrist and one psychologist. Both of them take notes, make me many questions and require my sister to come to be asked as she can tell more objectively than me how I was when I was a kid.</p>

<p>Then I got diagnosed ADHD of inatentive presentation and put on Medikinet 40mg. Initially 20mg to be ramped up to 40 in a week. Doctor knew I got my hands on Bupropion. Told me several ways to quit BP and add methylphenidate instead, I took the drastic one so I could get a clean picture of the effects.</p>

<p>This since ~May 2025 I think. I‚Äôm writing this in early September of the same year.</p>

<h1 id="moving-on-tritation">Moving on: Tritation</h1>

<p>The good news is that I won‚Äôt have to explain this background ever again and I have many months to try and test several theories. They said the diagnosis is just the start of the journey and <strong>oh boy they‚Äôre right.</strong>There‚Äôs so much that needs doing even when you have the right meds.</p>

<h2 id="beginnings-with-methylphenidate-and-unstable-results">Beginnings with Methylphenidate and unstable results</h2>

<p>The 20mg did the job I could finally sit in front of the computer and get work done. But the effect could never be made to last more than 3 hours. This changed when I reached the 40mg dosage. At the beginning I could have them last 4 days, then other days 8 hours or more. I tried to find the logic of it. For which I got my hands on Concerta just to understand the different mechanisms (also the pill bottle is prettier than Medikinet blisters).</p>

<p>I learnt 40mg of Medikinet is equivalent to 72mg of Concerta. But Concerta on any possible gramage, <strong>each and every time</strong>, altered with my sleep and made me wake up too tired. The effects where stretched so thin it was working while I was sleeping, while during the day I didn‚Äôt feel the effects strong enough as to reach the same level as medikinet.</p>

<p>So learning about their delivery mechanism I realised to make Medikinet last 8 hours or more I just needed to eat food with it. So I did, one morning gazpacho cup. And, like clockwork, it lasts the 8 hours, sometimes more.</p>

<p>Coffee became something I cannot drink anymore. One mug + MPX = extreme emotional disregulation.</p>

<h2 id="but-what-is-this-elvanse-thing-why-is-it-so-pricey-is-it-any-better">But what is this Elvanse thing? Why is it so pricey? Is it any better?</h2>

<p>As some long-gone dead person said ages ago:
**the grass is always greener on the other side&lt;/blockquote&gt;
So I got my hands on Elvanse 30mg. Those 30 did nothing but 60 did. Each bottle of 30 pills costs 83‚Ç¨ in Spain independently of miligrams per pill so I didn‚Äôt want to try increasing slower. Eventually tried full term 50mg and found that is the dosage that works best for me. But the effects are **very very different **than methylphenidate and ultimately decided to go back to Medikinet. Yet the experiment made me uncover another symptom I wasn‚Äôt aware of.</p>

<h2 id="the-3-main-issues-adhd-causes-me">The 3 main issues ADHD causes me</h2>

<ol>
  <li>Sleep disorder</li>
  <li>Executive disfuntion.</li>
  <li>Emotional disregulation.</li>
</ol>

<p>With Medikinet I get 1 and 2 sorted, I can work beautifully with zero issues to keep concentrated. With Elvanse what I noticed was entirely different, it fixed number 3. I noticed my irritability going entirely away. That‚Äôs when I realised the emotional disregulation did affect me too. I was a nicer person to people around me, whereas normally I have to self-censor constantly. It doesn‚Äôt happen every day nor at the same degree but sometimes it does.</p>

<p>Also my attention was very different on Elvanse, it gives me flexibility but it makes it hard to concentrate on just one thing at once. Task initiation was easy but task maintenance or task lock, hard. While with Medikinet task initiation is harder but task maintenance is easy.</p>

<p>Elvanse also seem to alter my immune system, and with 2 autoimmunes this is no joke. After years without activity I got a few cysts again. Had to go back to clindamicine and ibuprofen to keep them under control and still it became really hard.</p>

<p>Regarding my sleep it made me sleep less but deeper. I needed less hours of sleep to be fully refreshed. But then during the day I felt sleepy several times. So while it worked it wasn‚Äôt optimal. I don‚Äôt like napping.</p>

<h2 id="so-medikinet-or-elvanse">So Medikinet or Elvanse</h2>

<p>I‚Äôm not entirely 100% about Elvanse though because I‚Äôve learnt the sun (at least for me) alters both types of pills‚Äô effect and the time I did that trial I was in a dark apartment. Today that I took 50mg Elvanse as I was deep cleanign this flat, you can clearly see from this document that I‚Äôm having zero issues to concentrate for instance. The problem is the effects were inconsistent. While the one of Medikinet were <strong>a lot more</strong> consistent.</p>

<p>Elvanse also required me to take one L-tyrosine pill (500mg) each day around noon to keep the effect stable and the crash to a minimum. Also in the mornings despite waking up refreshed I felt anhedonia again. I felt as if someone had deprived me of any dopamine. So I tried with 1 bupropion pill at night (more on this later) and it worked but that‚Äôs too much complexity. I wanted simplicity. Less is more.</p>

<p>So I went back to Medikinet and kept the Elvanse for days I don‚Äôt need to work but need to run through several physical tasks (e.g.: deep cleaning of my flat). A one odd Elvanse pill instead of Medikinet for a day doesn‚Äôt do damage and it helps me get things done that don‚Äôt require that much focus or concentration but more of a wider attention span like planning or cleaning.</p>

<h2 id="back-to-methylphenidate">Back to Methylphenidate</h2>

<p>I went back to 40mg of Medikinet and tried to figure a way to get the 3 issues sorted with it instead. I never did, instead I managed to bring the 3rd one (emotional disregulation) to some degree of control but not entirely gone. I ultimately figured I couldn‚Äôt drink any caffeine at all with Medikinet, with Elvanse I made that mistake once and wow, that was a nightmare. By reducing caffeine intake to absolute zero it became ‚Äúless‚Äù of a problem but not entirely gone. I do still get it, just each day a bit less because I‚Äôm learning new ways.</p>

<p>So then I settled for Medikinet 40mg as my choice. Tritation‚Äôs over. Or is it not? We‚Äôll see.</p>

<h1 id="moving-on-self-applied-cognitive-behavioral-therapy-cbt">Moving on: Self-applied cognitive-behavioral therapy (CBT)</h1>

<p>Early on I discovered under the effects of the pills I had to do things differently to the ways I used to. I did try to find a psychologist from my private insurer that could help with this and had 2 sessions with one but they were crap. They didn‚Äôt focus on the ADHD but on stuff I wasn‚Äôt interested at all and found no helpful. So I stopped and decided to go my way until I can eventually find one that has decent training to deal with the specifics of ADHD instead. I knew about Cognitive-Behavioral Therapy (CBT) from a very long time ago. When I was a kid I used to read the psychology and psychiatry books of my local library trying to understand my own brain. I‚Äôm surprised I didn‚Äôt figure by then that I had ADHD.</p>

<p>The idea was to find what behaviours, actions and routines I need to change to make an optimal use of the way my brain works under the effects of the meds.</p>

<p>I hate psychiatrists hand you over the pills but they don‚Äôt give you this information.</p>

<h2 id="how-my-brain-works-despite-its-adhd">How my brain works despite its ADHD</h2>

<p>I have a degree in Computing Science and always had the highest marks at first and secondary school without making a concious effort. Since I was a kid I always struggled to concentrate on stuff I didn‚Äôt find interesting. So I learnt to convince myself of liking stuff. I always thought willpower and focus were hard for everybody, not just me, after all I always had high marks, why would I, as a kid, suspect of anything? I did spend extra time trying to understand how motivation, willpower and focus worked.</p>

<p>So for years I thought there was nothing neurodiverse with my brain, other than the fact I could learnt and process stuff quicker effortlessly. Everybody on my immediate environment including family, teachers and professors knew I have high-cognitive abilities so that never needed testing. That was my normal.</p>

<p>I have clutches, queues and shortcuts, I already told you one but let me enumerate the ones I have found so far:</p>

<ol>
  <li>I am a master at convincing myself of finding insteresting, things that I do not.</li>
  <li>I reduce the friction of those tasks that costs more or add adjacent rewards to make them pleasant. (e.g.: going to the gym = having a very long shower; going to the gym = leaving my mind to wonder for the duration of it; going to the gym = going through my Discovery Weekly spotify playlist). In other words: I wrapped them up with stuff I do enjoy. I call this The Burrito Method ‚Ñ¢Ô∏è</li>
  <li>I do sometimes overoptimize things just because my inatentiveness makes me see all the angles at once, it is exhausting though. But it‚Äôs incredibly good for planning or cleaning (beware my cleaning is not your cleaning, more on this later).</li>
  <li>I use my inatentiveness to plan ahead every decision, even multiple scenarios.</li>
  <li>I use my inatentiveness combined high my high-cognition (and probably this is where I differ the most with other ADHDers) to picture in my mind some sort of blackboard. I never had to write a TODO list in my entire life to know what I had to do‚Ä¶until the meds.</li>
</ol>

<h2 id="what-medikinet-exactly-does-to-me">What Medikinet exactly does to me</h2>

<p>Notice the ‚Äúto me‚Äù, results may vary. And a quick reminder</p>
<div><div>üòú</div><div>None of this is medical advice but **personal experience**</div></div>
<h3 id="the-good">The good</h3>

<ol>
  <li>Completely destroys my inattentiveness. My attention is 100% voluntary.</li>
  <li>Concentrating and maintaining that concentration on any single task at once is incredibly easy.</li>
  <li>Makes music sound a lot better.</li>
  <li>Makes noise bother me a lot less.</li>
  <li>Allows me to go to sleep at roughly the same time every day.</li>
  <li>Makes me able to do mental-heavy tasks past noon.</li>
  <li>Makes learning even easier.</li>
  <li>Sex is better without the mental noise.</li>
</ol>

<h3 id="the-bad">The bad</h3>

<ol>
  <li>Without the inattentiveness I now need to write TODO lists to know what I‚Äôm up to.</li>
  <li>Without the distractions I can lose track of other tasks that I need to do while the pills are working.</li>
  <li>Because I‚Äôm used to fake interest to trigger concentration, now I overdo it and can lose track of everything else on menial tasks that I found boring.</li>
  <li>Planning is hard and tasks that require a wider attention span are a lot harder too.</li>
  <li>Emotional disregulation is better than without meds but it doesn‚Äôt entirely solve it.</li>
</ol>

<h2 id="so-lets-do-things-differently-right">So let‚Äôs do things differently, right?</h2>

<p>We‚Äôre moving on from brain chemistry but still not leaving it too far behind as reference. What we‚Äôre doing from now is to find ways to work **with **or **around **it. For two goals: one, learn how to use it medicated (so as closed as neurotypical possible) and eventually learn how to **never **need the meds anymore. The second one is more of a long-term solution that can only be accomplished by truly learning the first one first.</p>

<h2 id="how-to-plan-now">How to plan now?</h2>

<p>Medikinet works after for me, ~1 hour after I take the pill. Peaks a lot later but generally I notice a shiver on my scalp during the beginning of its peak. Is almost as if it builds-up, builds-up, builds-up until it goes through a threshold and the shiver always happens. It pretty much feels as if someone was using one of those methalic head massagers on my scalp üëá
<img src="/assets/images/2025/09/image.png" alt="Image" />
Once it works, planning becomes really hard. I am an executioner, I can follow instructions I left behind, but I planning multiple unrelated things becomes hard. So</p>
<div><div>üí≠</div><div>**Change 1 - Plan Earlier**
Plan before you ingest the pill or up to 1 hour after ingesting it. </div></div>
<p>But sometimes the plans get modified along the way and you need to still remember the other stuff that came along the way and you need to do diffrently, so:</p>
<div><div>üí≠</div><div>**Change 2 - Assume forgetfulness**
If a task comes to mind during the effect of the pills, write it down</div></div>
<p>But then where do you check, do you check your phone TODOs? Do you check Obsidian? Do you check ticktick.com? Which one do you check?</p>
<div><div>üí≠</div><div>**Change 3 - Stick to what works**
For sure, try at first several note taking apps, eventually with practice you'll notice you use one more than the others, stick to that one then and delete the others. </div></div>
<h2 id="wait-where-is-my-time-gone-i-didnt-plan-to-spend-3-hours-on-this-the-role-of-tonic-vs-phasic-dopamine">Wait, where is my time gone? I didn‚Äôt plan to spend 3 hours on this. The role of Tonic vs Phasic dopamine</h2>

<p>If you‚Äôre like me and have mastered the art of convincing yourself of finding boring stuff <strong>very **interesting to somehow trigger your drive. You might now notice one side effect: **wasted time on nonsense.</strong></p>

<p>The stuff I previously like now can trigger me in such a way as if they were my life passions. I can completely override anything else I have to do that day and get 100% absorved into them and not realise how my time completely flied.</p>

<p>The problem is not the meds (this is my theory), the problem is **39 years of overcompensation **that‚Äôs why now with normal amounts of dopamine around **yet **still the same old-behaviours to compensate for **lack **of it, every like is overpowering. So,</p>
<div><div>üí≠</div><div>**Change 4 - Do not compensate to generate drive.**
If you like something you don't need to convince yourself you like it more to generate the sufficient drive, the pills already give you the material to do it the neurotypical way. 

This is one **hell of a drastic **change of behaviour and it'll take months or years for me to learn how to stop doing it. So check the time you spend on them often before it becomes hours. </div></div>
<p>The problem with this one is that it can portray itself as lack of executive function, when in reality is kind of too much of it <strong>on the wrong task.</strong>Since the switch from Elvanse back to Medikinet I‚Äôve kept thinking about this because I‚Äôve realised is not as clear cut as Medikinet solving sleep, exec disfunction and not emotional disregulation whereas Elvanse sleep, emotional disregulation (the most) but not exec disfunction but somewhere in between with the ones they don‚Äôt solve fully.</p>

<p>Trying to understand why exec disfunction is so hard for me on Elvanse is where I found this issue. With Elvanse I‚Äôm motivated on anything that comes to mind so it costs me to stay put on one task (tasks maintenance) but is not the meds, it‚Äôs me being used to the old-ways as measure. With Medikinet, task maintenance is easy and since motivation is easy to keep I can code for hours and hours. But also, if I rest and do something else for a bit, I might lose 4 hours on that thing without noticing, it‚Äôs like tunnel vision. So task initiation is what‚Äôs hard on Medikinet. Because you need ot choose **carefully **the task you start. As 5 minutes doing something fun, can lead to 5 hours of it before you notice.</p>

<p>So this applies to both and is why I think today Elvanse works, because I‚Äôm ensuring I don‚Äôt try something else and look track of time on it.</p>
<div><div>üí≠</div><div>**Change 5 - Don't estimate lenght of time on a simple liked task based on old-unmedicated you levels of motivation. Give priority to your main task.**
Because if you do, 5 minutes will become 5 hours on it. You have a lifetime of overcompensating. The motivation was there, the chemicals, not. You learnt ways to convince your brain to trigger the chemicals and based the time you'll be wasting on that task based on your unmedicated brain. Assume if you do something you like you might spend 5 hours on it and leave it for later. </div></div>
<p>Now what‚Äôs this thing I call <strong>tonic</strong> vs <strong>phasic</strong> dopa? First a quick reminder</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">‚ö†Ô∏è</div><div class="kg-callout-text">I'm not a neurologist</div></div>
<p>I tried to understsand the mechanisms of Lisdexamphetamine (Elvanse) vs Methylphenidate (Medikinet/Concerta) and why they worked differently for me. What I found in a nutshell is something along the lines (I‚Äôm writing this from memory) that if we imagine our brain as a bucket with some holes like this üëá
<img src="/assets/images/2025/09/image-1.png" alt="Image" />
Elvanse pretty much, for me, increases the flow of the tap whereas Medikinet patches the holes. Chemically speaking both do both tasks, it just changes the measure in which they do each. Imagine the water is your dopamine. Assume dopamine is that neurotransmitter that you have too little of, in certain key regions of the brain, the ones targetted by MPX or LDX.</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">üí°</div><div class="kg-callout-text">From now on assume MPX refers to Medikinet/methylphenidate and LSD refers to Elvanse/lisdexhamphetamine</div></div>
<p>Unmedicated up until noon my ADHD issues are not that bad, after 1pm is when they start getting worse. So my theory is that my problems with dopamine are not generation but reuptake. Using the bucket analogy, the holes keep getting bigger after 1pm. This is probably why my ADHD is of inatentive type. More on this shortly.</p>

<p>Dopamine is not as clear cut as it sound either. There are two types of it, one is tonic dopa and the other is phasic dopa and I don‚Äôt quite understand the mechanisms that convers one into the other. The tonic one is the one we produce steadily around the day while the phasic one is the one we produce when we concentrate on a task. The one you lack the most might define the presentation of ADHD you have and the meds you need (if on the stimulant choice). Now reminder</p>
<div class="kg-card kg-callout-card kg-callout-card-blue"><div class="kg-callout-emoji">‚ö†Ô∏è</div><div class="kg-callout-text">I'm not a a pharmacyst, nor a psychiatrist, nor a neurologyst, I'm just an ADHDer of inatentive presentation trying to make sense of what works and what doesn't for me. </div></div>
<p>My theory is Elvanse is brilliant for people with problems of the tonic dopa type (scarcity the whole damn day) while MPX for people with problems of the phasic dopa type (reuptake of this one being too quick or accelerating through the day). Which is why MPX works better for me and my biggest struggle **unmedicated **is with task maintenance, not task initiation. While medicated becomes **task initiation **because if I start the wrong task I can get stuck on it and not notice.</p>

<h2 id="the-80mg-accident-tritation-20">The 80mg accident: Tritation 2.0.</h2>

<p>I‚Äôm moving flats, I‚Äôm living in temporary free accomodation, long story. The thing is I made a mistake and believing I didn‚Äôt have my 40mg pill while I was picking up stuff from one flat, I took the 40mg in the other. That‚Äôs 80mg of Medikinet. The day was <strong>interesting.</strong></p>

<p>To begin with the day was very cloudy, dark and rainy. I went out to fetch something and the shivers on my scalp that mark the beginning of the pills peaking, felt otherwordly. The good benefits of the pills were feeling extra sharp. And the mental silence was for first time in months absolute zero. I immediately realised I took 2 pills.</p>

<p>I did nothing, I just let the day go ahead as planned, worked, got stuff done. Everything fine. Sleeping was a bit harder than usual but not that much because Medikinet has a short life anyway.</p>

<p>But it made me thing, because for first time ever. Medikinet satisfied the 3 issues, a reminder:</p>
<div><div>3Ô∏è‚É£</div><div>**My 3 ADHD issues**
1. Sleep disorders
2. Executive disfunction
3. Emotional disregulation</div></div>
<p>For first time ever, Medikinet fixed emotional disregulation, just like Elvanse did. So I wondered: am I taking too little? I talked to my psychiatrist and we‚Äôre back on tritation. I was on 40mg, she told me to hike the dosage to 50mg for a week and then 60mg for the next and compare the results then talk to her. But then the sun as a factor became obvious.</p>

<h2 id="the-strange-role-of-sunlight">The strange role of sunlight</h2>

<p>This new flat I just moved into when I made the 80mg mistake is a lot sunnier than the one I was before. While I‚Äôm working I get as much sunlight as if I were on the street. The windows are big on the office.</p>

<p>The day I took the 80mg it was dark, no sunlight and my ADHD was gone. Whereas now on this new tritation, the days I took 50mg, the results changed drastically depending on weather. Even more so 60mg (I‚Äôm there now) which can be overpowering (too much) on sunny days.</p>

<p>I don‚Äôt seem to find objective information about the role of sunlight on ADHD other than it benefits children, as usual, all ADHD studies are focused on children not adults. All I could find is that the synthesis of vitamin D by the skin somehow triggers also stimulates the synthesis of dopamine. But I haven‚Äôt found a clear cut explanation of how, why, in what amounts etc yet. It‚Äôs all taken with a pinch of salt. I need to find more about this, but for now this is what I can doüëá</p>
<div><div>üí≠</div><div>**Change 6 - Prioritise sun over meds **
If the meds seem to work better after being exposed even just 10 minutes to direct sunlight. Go out when you see sunlight for ~10 minutes. </div></div>
<p>I might go back down to 50mgs though and convince my psychiatrist somehow of allowing me prescription window whereas I keep 50mgs as baseline (40 don‚Äôt do enough anymore) and can up the dosage to 60 on darker days.</p>

<p>In Coru√±a this is harder to predict becuase the weather is very unstable, but in C√°diz the weather is more stable and generally sunny. A dark day is rare and we know in advance because the weather prediction is rarely wrong. If I stick in Coru√±a to 60mg, that is going to be too much in C√°diz.</p>

<h2 id="the-theory-of-the-stack">The theory of the stack</h2>

<p>The mind of an ADHDer seems to be a stack. When there‚Äôs something on the top of the stack it is hard to get to everything else unless you get that one thing out of the way. Methylphenidate makes this a lot easier but still.</p>

<p>My friend Remi is above 50 years old and cannot stop talking, his mouth has a life of its own, he displayed all sort of signs of ADHD and I told him, he starteda asking around to other friends and they all said the same ‚ÄúI thought you knew‚Äù. I told him it would be worth to get it evaluated as his verborreic mouth <strong>fucks his social life</strong> heavily and controlling his symptons will make his life a lot simpler. It took a while but he went to my same clinic, and got a diagnosis, in his case the diagnosis report said something along the lines of primarily inatentive with impulse discontrol of speech.</p>

<p>I went with him to the interview where he needed a friend or family to talk about what‚Äôs weird of him objectively. I was there the whole interview, the parts they ask for me and the parts they ask of him, and discovered his ways to cope. Among them is this stack that I‚Äôve seen so many ADHDers do.</p>

<p>If a task gains priority, nothing else will get done until that task is moved out of the way. So this ADHDers when they get a new task at work, they just do it immediately, no questions, no priorities, new = done, then next. It requires zero planning, you just do things on a LIFO (last-in, first-out) fashion. Which is not at all my way‚Ä¶.until it is.</p>

<p>If something **really **claims my attention, no amount of pills is going help me. My best choice is to get that done or closed or dealt with ASAP. I‚Äôve been for a long time trying to answer the question C√°diz or staying in Coru√±a. I‚Äôd rather stay in Coru√±a but if the housing market doesn‚Äôt allow me, then there‚Äôs no point. I hate sharing flats. I‚Äôm almost 40, it‚Äôs fun when you‚Äôre on your 20s, it isn‚Äôt when you have patterns, rigid lifestyles, **discipline **and order on your life to share with a total stranger that will have very different routines and ways to live on their homes. It has taken me **a long time **on giving up on the idea of living in Coru√±a. But probably moving to Adrian‚Äôs flat and discovering the effect of the sun moved the balanced towards C√°diz. Moral of the story, that worry got out of my way, hello productivity again.</p>
<div><div>üí≠</div><div>**Change 7 - Prioritise distractions you can't shake even medicated.**
If there's a distraction of some personal circumstance that is big enough to keep your attention even when the meds are working, just fix it, deal with it, solve it or give up on it. Otherwise you'd be just wasting your time. </div></div>
<h2 id="the-role-of-coffee">The role of coffee</h2>

<p>I can‚Äôt drink coffee. It is that simple. Today I did have a mug of it very early but I haven‚Äôt had any coffee in more than a week, one mug a week is not enough to do damage. I even had an Elvanse 2 hours after it without any issues.</p>

<p>Coffee in either case MPX or LDX produces the same effect, emotional disregulation taken to the next level. In the case of MPX completely changes the effect of the pills to the worse. In the case of LDX, it pretty much flips them over, if emotional regulation is the thing I get the most from Elvanse, incredible disregulated emotions is what I get if I take a coffee during its effect. It did reach levels of panic attack. I made the mistake once and never did it again.</p>

<p>Today doesn‚Äôt count, 2 hours after that mug the effects of caffeine were long gone. The only reaosn I took that coffee today was because sun + 60mg of medikinet yesterday were so overpowerin i struggled to sleep so I did take 1 doxilamine, like in the old days. And to cancel out the doxilamine in the morning, nothing works like coffee. Otherwise you feel like an alcohol hangover. It all worked perfectly.</p>

<p>So now I drink decaff. I realised my addiction is more to the routine of preparing it, than to the caffeine itself.</p>

<h2 id="the-role-of-movement">The role of movement</h2>

<p>Once thing I get the feeling of is that my brain doesn‚Äôt work correctly unless my body has been moving for a while (either gym or running). Hence why I think working out first thing is the way to go and something I should never change. Since I‚Äôm leaving Coru√±a I already cancelled the gym. So as soon as I wake up I try to find physical stuff to do. Sometimes is doing some deep cleaning of some part of this house, most times is running 5K.</p>
<div><div>üí≠</div><div>**Change 8 - First thing of the day: MOVE**
Before you do stuff that requires concentration, if you're not going to the gym then go for a 5K run or do a deep cleaning of the house. Whatever it is, it has to be physical and require movement. </div></div>
<h2 id="the-role-of-social-media">The role of social media</h2>

<p>This goes hand in hand with change number 5. Since you‚Äôre used to overcompensating to generate drive, this is specifically for social media. If there‚Äôs a subject you‚Äôre passionate about you can indeed spend hours on it. So,</p>
<div><div>üí≠</div><div>**Change 9 - Block, block, block during working hours**
Phone on the other side of the bedroom or different bedroom. Reddit, Youtube, Mastodon, etc all blocked with whatever extension (I use Blocksite: [https://blocksite.co/](https://blocksite.co/)) allows you to get them out of the way. </div></div>
<p>Once you‚Äôre out of working hours, feel free to disable the extension and use your distractin devices a.k.a.: smartphone.</p>

<h1 id="more-comming-soon">More comming soon</h1>

<p>This is all for today, which is not little, the next episode, will include more but won‚Äôt need the background section. Yay! I‚Äôll keep focusing on changes. I have not reviewed the text, not edited it, nor used any LLM to write it, it‚Äôs all straight from my mind so pardon the typos if you find any. And please <strong>do comment.</strong></p>
<div><div>ü´∞</div><div>I'm not selling you anything at all. Not now, not ever, but eventually, since this blog costs money I'll have to figure a way to fund it. The fediverse extension of Ghost.io requires a paid membership unless one has the time (and patience) to install and configure its own server. 

At the moment the cost of running this blog is 35 USD per month. 

This article is free but feel free to donate using [this link](https://blog.maikel.dev/#/portal/support)</div></div>
<h2 id="where-to-find-me">Where to find me</h2>

<p>I‚Äôm mostly on Mastodon these days, as a software engineer I cannot tolerate having my random ramblings and thoughts centralised by a commercial entity so you can find me there with the handle <a href="https://vmst.io/deck/@maikel">@maikel@vmst.io</a> . Mastodon is filled with minorities that are either ignored or silenced in other platforms (LGBTQ+ people, autistic spectrum people, ADHD people, lots of groups). It‚Äôs really easy to find and compare experiences there with other ADHDers without rudeness, trolls, or bad actors. And there are even group accounts where you can post for everyone subscribed to that account (e.g: @adhd@a.gup.pe) to receive your posts. I highly recommend it. The fediverse is probably the social media of the future, where <strong>you</strong> are not a product.</p>]]></content><author><name>Maikel Frias Mosquea</name></author><category term="ADHD" /><summary type="html"><![CDATA[My experience with ADHD and what has been working so far ever since starting on medication.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.maikel.dev/assets/images/unsplash-1542195830.jpg" /><media:content medium="image" url="https://blog.maikel.dev/assets/images/unsplash-1542195830.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>